<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achieve-mate | Student Productivity</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Theme Variables */
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --bg-sidebar: #0f172a; 
            
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --accent: #fbbf24;
            --success: #10b981;
            --danger: #ef4444;
            
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            
            --radius-lg: 16px;
            --radius-md: 12px;
            
            --shadow-glow: 0 0 15px rgba(99, 102, 241, 0.3);
            --font-main: 'Inter', sans-serif;
            --font-heading: 'Poppins', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; scrollbar-width: thin; scrollbar-color: var(--border) var(--bg-body); }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: var(--font-main); line-height: 1.6; overflow-x: hidden; }

        /* --- Layout --- */
        .app-wrapper { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 1.5rem; position: fixed; height: 100vh; z-index: 50; transition: transform 0.3s ease; }
        .brand { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2.5rem; color: var(--primary); font-family: var(--font-heading); font-weight: 700; font-size: 1.25rem; }
        
        .nav-item { display: flex; align-items: center; gap: 1rem; padding: 0.875rem 1rem; border-radius: var(--radius-md); color: var(--text-muted); cursor: pointer; transition: all 0.2s ease; font-weight: 500; margin-bottom: 0.5rem; }
        .nav-item:hover { background: var(--bg-card-hover); color: var(--text-main); }
        .nav-item.active { background: var(--primary); color: white; box-shadow: var(--shadow-glow); }

        /* Main Content */
        .main-content { flex: 1; margin-left: 260px; padding: 2rem; max-width: 1600px; padding-bottom: 100px; }

        /* Mobile Nav */
        .mobile-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-card); border-top: 1px solid var(--border); padding: 0 1rem; justify-content: space-around; z-index: 100; padding-bottom: env(safe-area-inset-bottom); height: 70px; align-items: center; }
        .mobile-nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-muted); font-size: 0.7rem; padding: 8px 16px; cursor: pointer; transition: all 0.2s; border-radius: 12px; }
        .mobile-nav-item i { font-size: 1.3rem; margin-bottom: 2px; transition: transform 0.2s; }
        .mobile-nav-item.active { color: #fff; background: var(--primary); box-shadow: 0 4px 12px rgba(99,102,241,0.4); transform: translateY(-5px); }
        .mobile-nav-item.active i { transform: scale(1.1); }

        /* Header */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .header-left { display: flex; flex-direction: column; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        
        .greeting h1 { font-family: var(--font-heading); font-size: 1.75rem; font-weight: 600; line-height: 1.2; }
        .streak-badge { display: flex; align-items: center; gap: 0.75rem; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.2); padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; transition: transform 0.2s; white-space: nowrap; height: fit-content; }
        .streak-badge:hover { transform: translateY(-2px); background: rgba(251, 191, 36, 0.15); }
        .streak-count { font-weight: 700; color: var(--accent); font-size: 1.1rem; }
        .streak-label { font-size: 0.8rem; color: var(--accent); text-transform: uppercase; letter-spacing: 0.5px; }
        
        .mobile-settings-btn { display: none; font-size: 1.4rem; color: var(--text-muted); cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s; }
        .mobile-settings-btn:hover { background: var(--bg-card-hover); color: var(--text-main); }
        .mobile-settings-btn.active { color: var(--primary); background: rgba(99,102,241,0.1); }

        /* Cards & Grid */
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1.5rem; }
        .card-title { font-family: var(--font-heading); font-size: 1.1rem; font-weight: 600; margin-bottom: 1.25rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-main); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .grid-dashboard { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 1.5rem; }

        /* Components */
        .btn { border: none; outline: none; cursor: pointer; font-family: var(--font-main); font-weight: 500; border-radius: var(--radius-md); padding: 0.75rem 1.5rem; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.95rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
        .btn-secondary { background: var(--bg-card-hover); color: var(--text-main); border: 1px solid var(--border); }
        .btn-secondary:hover { background: #475569; }
        .btn-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.2); }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.85rem; }
        
        input, select, textarea { width: 100%; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); padding: 0.75rem 1rem; border-radius: var(--radius-md); font-family: var(--font-main); font-size: 0.95rem; transition: border-color 0.2s; }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); }

        /* Consistency Graph */
        .graph-container { display: flex; justify-content: space-between; align-items: flex-end; height: 240px; padding: 30px 15px 10px 15px; background: linear-gradient(to bottom, rgba(30,41,59,0.3), rgba(15,23,42,0.3)); border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
        .graph-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 12px; height: 100%; justify-content: flex-end; position: relative; cursor: default; }
        .graph-track { width: 14px; height: 100%; background: rgba(255,255,255,0.03); border-radius: 20px; position: relative; overflow: hidden; display: flex; align-items: flex-end; }
        .graph-bar { width: 100%; background: linear-gradient(180deg, var(--primary) 0%, var(--primary-hover) 100%); border-radius: 20px; transition: height 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); min-height: 0; box-shadow: 0 0 10px rgba(99, 102, 241, 0.2); }
        .graph-label { font-size: 0.75rem; color: var(--text-muted); font-weight: 600; margin-top: 4px; }
        .graph-tooltip { position: absolute; top: -35px; background: var(--bg-card-hover); color: #fff; font-size: 0.7rem; font-weight: 700; padding: 4px 8px; border-radius: 6px; opacity: 0; transform: translateY(8px); transition: all 0.2s ease; border: 1px solid var(--border); white-space: nowrap; pointer-events: none; z-index: 10; }
        .graph-tooltip::after { content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%); border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 4px solid var(--bg-card-hover); }
        .graph-col:hover .graph-tooltip { opacity: 1; transform: translateY(0); }
        .graph-col:hover .graph-bar { filter: brightness(1.2); }

        /* Course Filters */
        .course-filter-container { display: flex; gap: 10px; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        .course-tab { background: none; border: none; color: var(--text-muted); font-weight: 600; font-size: 0.95rem; cursor: pointer; padding: 0.5rem 1rem; border-radius: 20px; transition: all 0.2s; }
        .course-tab.active { background: var(--bg-card-hover); color: var(--text-main); }
        .swipe-instruction { display: none; font-size: 0.75rem; color: var(--text-muted); text-align: center; margin-bottom: 1rem; opacity: 0.7; }

        /* Courses Grid */
        .courses-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 1.5rem; }
        .fade-slide { animation: fadeSlide 0.3s ease-out; }
        @keyframes fadeSlide { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }

        .course-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; transition: all 0.3s ease; display: flex; flex-direction: column; position: relative; }
        .course-card:hover { transform: translateY(-4px); border-color: var(--primary); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        
        .course-header { padding: 1.5rem; background: linear-gradient(to bottom right, rgba(30,41,59,1), rgba(15,23,42,1)); border-bottom: 1px solid var(--border); position: relative; cursor: pointer; }
        .course-header-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; margin-bottom: 0.5rem; }
        .course-badge { font-size: 0.7rem; padding: 0.25rem 0.75rem; border-radius: 20px; background: rgba(99, 102, 241, 0.1); color: var(--primary); border: 1px solid rgba(99, 102, 241, 0.2); font-weight: 600; text-transform: uppercase; white-space: nowrap; flex-shrink: 0; }
        .course-title { font-family: var(--font-heading); font-size: 1.15rem; font-weight: 600; line-height: 1.4; display: flex; align-items: center; gap: 8px; flex: 1; }
        .course-title i { font-size: 0.9rem; opacity: 0.5; transition: transform 0.3s; margin-top: 3px; }
        .course-card.expanded .course-title i { transform: rotate(180deg); color: var(--primary); opacity: 1; }
        .course-meta { font-size: 0.85rem; color: var(--text-muted); display: flex; gap: 1rem; margin-top: 0.5rem; }
        .course-progress-area { padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .progress-bar-bg { height: 6px; background: var(--bg-body); border-radius: 3px; overflow: hidden; margin-bottom: 0.5rem; }
        .progress-bar-fill { height: 100%; background: var(--success); border-radius: 3px; transition: width 0.5s ease; }
        .progress-text { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); font-weight: 500; }
        .video-accordion { max-height: 0; overflow: hidden; transition: max-height 0.4s cubic-bezier(0, 1, 0, 1); background: var(--bg-card); }
        .video-accordion.open { max-height: 400px; overflow-y: auto; }
        .course-edit-btn { position: absolute; bottom: 15px; right: 15px; z-index: 5; background: var(--bg-card-hover); color: var(--text-muted); border: 1px solid var(--border); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .course-edit-btn:hover { color: var(--text-main); border-color: var(--text-muted); }
        
        /* Check Items */
        .check-item { display: flex; align-items: center; gap: 12px; padding: 12px 15px; border-bottom: 1px solid rgba(255,255,255,0.05); transition: background 0.2s; cursor: pointer; }
        .check-item:hover { background: rgba(255,255,255,0.03); }
        .check-circle { width: 22px; height: 22px; border-radius: 6px; border: 2px solid var(--text-muted); display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
        .check-item.checked .check-circle { background: var(--success); border-color: var(--success); }
        .check-item.checked .check-circle::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: #fff; font-size: 12px; }
        .check-text { font-size: 0.95rem; color: var(--text-main); transition: color 0.2s; line-height: 1.4; }
        .check-item.checked .check-text { color: var(--text-muted); text-decoration: line-through; }

        /* Achievements (Improved Mobile Alignment) */
        .ach-filters { display: flex; gap: 10px; margin-bottom: 1.5rem; overflow-x: auto; white-space: nowrap; -ms-overflow-style: none; scrollbar-width: none; padding-bottom: 5px; }
        .ach-filters::-webkit-scrollbar { display: none; }
        .ach-filter-btn { padding: 0.5rem 1rem; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-muted); cursor: pointer; font-size: 0.9rem; transition: all 0.2s; flex-shrink: 0; }
        .ach-filter-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .ach-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.25rem; display: flex; gap: 1rem; align-items: flex-start; opacity: 0.6; filter: grayscale(0.8); transition: all 0.3s; position: relative; }
        .ach-card.earned { opacity: 1; filter: grayscale(0); border-color: var(--accent); background: linear-gradient(135deg, var(--bg-card), rgba(251, 191, 36, 0.05)); transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .ach-icon { min-width: 48px; height: 48px; background: var(--bg-body); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--text-muted); }
        .ach-card.earned .ach-icon { background: rgba(251, 191, 36, 0.2); color: var(--accent); box-shadow: 0 0 15px rgba(251, 191, 36, 0.2); }
        .badge-progress-wrapper { margin-top: 0.5rem; width: 100%; }
        .badge-progress-bg { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; margin-top: 4px; }
        .badge-progress-fill { height: 100%; background: var(--primary); border-radius: 2px; transition: width 0.5s; }
        .badge-progress-text { font-size: 0.75rem; color: var(--text-muted); display: flex; justify-content: space-between; }

        /* Modals */
        .modal-overlay, #focus-overlay, #onboarding-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-overlay.active, #focus-overlay.active, #onboarding-overlay.active { display: flex; animation: fadeIn 0.2s; }
        .modal-box { background: var(--bg-card); width: 90%; max-width: 600px; border-radius: var(--radius-lg); border: 1px solid var(--border); padding: 2rem; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); position: relative; }
        
        /* Calendar */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 1rem; touch-action: pan-y; }
        .cal-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 0.9rem; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; position: relative; }
        .cal-day:hover { border-color: var(--primary); background: var(--bg-body); }
        .cal-day.today { background: var(--accent); color: #000; font-weight: 700; }
        .cal-day.selected { border-color: var(--primary); background: rgba(99,102,241,0.15); box-shadow: 0 0 10px rgba(99,102,241,0.3); }
        .cal-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--primary); position: absolute; bottom: 6px; display: none; }
        .cal-day.has-data .cal-dot { display: block; }
        
        /* Improved Activity Log */
        .activity-log-container { max-height: 300px; overflow-y: auto; padding-right: 5px; }
        .activity-group { background: var(--bg-card-hover); border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--text-muted); overflow: hidden; }
        .activity-group.type-study { border-color: var(--primary); }
        .activity-group.type-goal { border-color: var(--success); }
        
        .group-header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .group-title { font-weight: 600; font-size: 0.95rem; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
        .group-count { font-size: 0.75rem; background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 12px; color: var(--text-muted); }
        .group-items { padding: 0 15px 10px 15px; display: none; font-size: 0.85rem; color: var(--text-muted); }
        .group-items.show { display: block; }
        .group-item { padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* Onboarding */
        .step-card { background: var(--bg-body); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1rem; text-align: center; }
        .step-icon { font-size: 2rem; color: var(--accent); margin-bottom: 1rem; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes confetti-fall { 0% { transform: translateY(-100%) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .confetti { position: fixed; top: 0; width: 10px; height: 10px; z-index: 3000; pointer-events: none; }

        /* Mobile Specifics */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .main-content { margin-left: 0; padding: 1.25rem; padding-bottom: 90px; }
            .mobile-nav { display: flex; }
            .mobile-settings-btn { display: block; }
            .grid-2, .grid-dashboard { grid-template-columns: 1fr; }
            .courses-grid { grid-template-columns: 1fr; }
            .swipe-instruction { display: block; }
            /* Adjust Header for Mobile */
            .page-header { flex-direction: row; align-items: center; gap: 10px; }
            .greeting h1 { font-size: 1.2rem; }
            .greeting p { font-size: 0.75rem; }
            .streak-badge { padding: 0.3rem 0.8rem; }
            .streak-label { display: none; }
            .streak-count { font-size: 1rem; }
            /* Focus Overlay Mobile Fix */
            #focus-overlay h1 { font-size: 1.5rem; }
            #overlayTimer { font-size: 5rem; }
        }
    </style>
</head>
<body>

    <nav class="mobile-nav">
        <div class="mobile-nav-item active" onclick="switchTab('dashboard')"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="mobile-nav-item" onclick="switchTab('courses')"><i class="fas fa-book"></i><span>Courses</span></div>
        <div class="mobile-nav-item" onclick="switchTab('goals')"><i class="fas fa-bullseye"></i><span>Goals</span></div>
        <div class="mobile-nav-item" onclick="switchTab('focus')"><i class="fas fa-clock"></i><span>Focus</span></div>
        <div class="mobile-nav-item" onclick="switchTab('achievements')"><i class="fas fa-trophy"></i><span>Awards</span></div>
    </nav>

    <div class="app-wrapper">
        <aside class="sidebar">
            <div class="brand"><i class="fas fa-graduation-cap"></i><span>Achieve-mate</span></div>
            <div class="nav-item active" onclick="switchTab('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-item" onclick="switchTab('courses')"><i class="fas fa-play-circle"></i> My Courses</div>
            <div class="nav-item" onclick="switchTab('goals')"><i class="fas fa-bullseye"></i> Daily Goals</div>
            <div class="nav-item" onclick="switchTab('achievements')"><i class="fas fa-trophy"></i> Achievements</div>
            <div class="nav-item" onclick="switchTab('focus')"><i class="fas fa-stopwatch"></i> Focus Mode</div>
            <div class="nav-item" onclick="switchTab('settings')"><i class="fas fa-sliders-h"></i> Settings</div>
        </aside>

        <main class="main-content">
            <header class="page-header">
                <div class="header-left">
                    <div class="greeting">
                        <h1 id="greetingText">Good Morning!</h1>
                        <p id="dateDisplay" style="color:var(--text-muted); font-size:0.9rem;">Loading date...</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="streak-badge" onclick="openCalendarModal()">
                        <i class="fas fa-fire" style="color: var(--accent)"></i>
                        <div class="streak-count" id="headerStreak">0</div>
                        <div class="streak-label" style="margin-left: 5px;">Streak</div>
                    </div>
                    <i class="fas fa-cog mobile-settings-btn" id="mobileSettingsIcon" onclick="toggleMobileSettings()"></i>
                </div>
            </header>

            <!-- DASHBOARD -->
            <div id="dashboard-view" class="view-section">
                <div class="grid-dashboard">
                    <div>
                        <div class="card">
                            <div class="card-title"><i class="fas fa-tasks"></i> Today's Priority</div>
                            <div id="dashboardGoalsList"></div>
                            <button class="btn btn-secondary btn-sm" style="width: 100%; margin-top: 1rem;" onclick="switchTab('goals')"><i class="fas fa-plus"></i> Manage Goals</button>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div class="card">
                            <div class="card-title"><i class="fas fa-chart-line"></i> Progress</div>
                            <div style="display: flex; justify-content: space-around; text-align: center; padding: 10px 0;">
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary);" id="topicPct">0%</div>
                                    <div style="font-size: 0.9rem; color: var(--text-muted);">Topics</div>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent);" id="goalPct">0%</div>
                                    <div style="font-size: 0.9rem; color: var(--text-muted);">Goals</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Victory Card -->
                        <div class="card" id="recentVictoryCard" style="background: linear-gradient(135deg, var(--bg-card), rgba(251, 191, 36, 0.1)); border-color: rgba(251, 191, 36, 0.3);">
                            <div class="card-title" style="color: var(--accent);"><i class="fas fa-crown"></i> Recent Victory</div>
                            <div id="recentBadgeContent" style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 2rem; color: var(--accent);"><i class="fas fa-lock"></i></div>
                                <div>
                                    <div style="font-weight: 600;">No Badges Yet</div>
                                    <div style="font-size: 0.85rem; color: var(--text-muted);">Start learning to unlock!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COURSES (Swipe Enabled) -->
            <div id="courses-view" class="view-section" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 style="font-family: var(--font-heading); font-size: 1.5rem;">Learning Playlists</h2>
                        <button class="btn btn-primary" onclick="openModal('addPlaylistModal')"><i class="fas fa-plus"></i> Add Course</button>
                    </div>
                    
                    <!-- Course Filters -->
                    <div class="course-filter-container">
                        <button class="course-tab active" onclick="filterCourses('all', this)">All</button>
                        <button class="course-tab" onclick="filterCourses('active', this)">In Progress</button>
                        <button class="course-tab" onclick="filterCourses('completed', this)">Completed</button>
                    </div>
                    <div class="swipe-instruction"><i class="fas fa-arrow-left"></i> Swipe to filter <i class="fas fa-arrow-right"></i></div>

                    <div id="courseSwipeArea" style="min-height: 200px;">
                        <div id="playlistsContainer" class="courses-grid"></div>
                    </div>
                </div>
            </div>

            <!-- GOALS -->
            <div id="goals-view" class="view-section" style="display: none;">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-title"><i class="fas fa-calendar-check"></i> Today's Goals</div>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                            <input type="text" id="newGoalInput" placeholder="Main focus today?">
                            <button class="btn btn-primary" onclick="addGoal()">Add</button>
                        </div>
                        <div id="fullGoalsList"></div>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="fas fa-chart-bar"></i> 7-Day Consistency</div>
                        <div class="graph-container" id="consistencyGraph"></div>
                    </div>
                </div>
            </div>

            <!-- ACHIEVEMENTS -->
            <div id="achievements-view" class="view-section" style="display: none;">
                <div class="card">
                    <div style="margin-bottom: 1.5rem;">
                        <h2 style="font-family: var(--font-heading);">Badges & Milestones</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">Unlocked: <span id="achieveCount" style="color: var(--accent); font-weight: 700;">0</span> / 17</p>
                        <div class="ach-filters">
                            <button class="ach-filter-btn active" onclick="filterBadges('all', this)">All</button>
                            <button class="ach-filter-btn" onclick="filterBadges('streak', this)">Streak</button>
                            <button class="ach-filter-btn" onclick="filterBadges('playlist', this)">Courses</button>
                            <button class="ach-filter-btn" onclick="filterBadges('focus', this)">Focus</button>
                        </div>
                    </div>
                    <div class="achievements-grid" id="achievementsGrid"></div>
                </div>
            </div>

            <!-- FOCUS MODE -->
            <div id="focus-view" class="view-section" style="display: none;">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-title" style="justify-content: center;"><i class="fas fa-brain"></i> Setup Session</div>
                        <input type="text" id="focusTaskInput" placeholder="What are you working on?" style="text-align: center; margin-bottom: 1.5rem;">
                        
                        <label style="color: var(--text-muted); font-size: 0.9rem;">Duration (Minutes)</label>
                        <div style="display: flex; justify-content: center; gap: 10px; margin: 0.5rem 0 1.5rem 0;">
                            <input type="number" id="customFocusTime" value="25" style="width: 80px; text-align: center;">
                            <button class="btn btn-secondary btn-sm" onclick="setCustomTime(25)">25m</button>
                            <button class="btn btn-secondary btn-sm" onclick="setCustomTime(45)">45m</button>
                            <button class="btn btn-secondary btn-sm" onclick="setCustomTime(60)">60m</button>
                        </div>
                        
                        <button class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;" onclick="startFullScreenFocus()"><i class="fas fa-play"></i> Start Focus</button>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="fas fa-history"></i> Recent Sessions</div>
                        <div id="focusHistoryList" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
            
            <!-- SETTINGS -->
            <div id="settings-view" class="view-section" style="display: none;">
                <div class="card">
                    <div class="card-title">Data Management</div>
                    <p style="color: var(--text-muted); margin-bottom: 1rem;">Your data is stored locally in your browser.</p>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="exportData()"><i class="fas fa-download"></i> Export Backup</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()"><i class="fas fa-upload"></i> Import Data</button>
                        <button class="btn btn-danger" onclick="clearData()"><i class="fas fa-trash-alt"></i> Reset All Data</button>
                        <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(this)">
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Help & Support</div>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                         <button class="btn btn-secondary" onclick="showOnboarding()"><i class="fas fa-question-circle"></i> Show Welcome Guide</button>
                         <button class="btn btn-secondary" onclick="contactDeveloper()"><i class="fas fa-envelope"></i> Connect with Developer</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- FULL SCREEN FOCUS OVERLAY -->
    <div id="focus-overlay" style="flex-direction: column; text-align: center;">
        <div style="font-size: 1.5rem; color: var(--text-muted); margin-bottom: 1rem;" id="overlayTask">Deep Work</div>
        <div style="font-size: 6rem; font-weight: 700; color: var(--primary); font-family: monospace; line-height: 1;" id="overlayTimer">25:00</div>
        <div style="margin-top: 3rem;">
            <button class="btn btn-danger" style="padding: 1rem 2rem; font-size: 1.2rem;" onclick="stopFullScreenFocus()"><i class="fas fa-stop"></i> Stop Session</button>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Add Playlist -->
    <div class="modal-overlay" id="addPlaylistModal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;"><h3>New Course</h3><button class="btn btn-sm" onclick="closeModal('addPlaylistModal')">âœ•</button></div>
            <form onsubmit="savePlaylist(event)" id="addCourseForm">
                <input type="text" id="plName" required placeholder="Course Name" style="margin-bottom: 1rem;">
                <div style="display:flex; gap:1rem; margin-bottom:1rem;">
                    <select id="plSource" style="width:40%;">
                        <option value="Youtube">YouTube</option>
                        <option value="Udemy">Udemy</option>
                        <option value="Coursera">Coursera</option>
                    </select>
                    <input type="url" id="plUrl" placeholder="Link (Optional)">
                </div>
                <label>Videos / Topics (One per line)</label>
                <textarea id="plVideos" rows="6" required style="margin-bottom: 1rem;"></textarea>
                <button type="submit" class="btn btn-primary" style="width:100%">Add Course</button>
            </form>
        </div>
    </div>

    <!-- Edit Playlist -->
    <div class="modal-overlay" id="editPlaylistModal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;"><h3>Edit Course</h3><button class="btn btn-sm" onclick="closeModal('editPlaylistModal')">âœ•</button></div>
            <input type="hidden" id="editPlId">
            <label>Name</label>
            <input type="text" id="editPlName" style="margin-bottom: 1rem;">
            <label>Bulk Edit Topics (Preserves status if title matches)</label>
            <textarea id="editPlVideos" rows="8" style="margin-bottom: 1rem;"></textarea>
            <div style="display: flex; justify-content: space-between;">
                <button class="btn btn-danger" onclick="deletePlaylist()">Delete</button>
                <button class="btn btn-primary" onclick="saveEditedPlaylist()">Save</button>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div class="modal-overlay" id="calendarModal">
        <div class="modal-box" style="max-width: 800px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;"><h3>History Log</h3><button class="btn btn-sm" onclick="closeModal('calendarModal')">âœ•</button></div>
            <div class="grid-2">
                <div id="calSwipeArea">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <button class="btn btn-sm btn-secondary" onclick="changeCalMonth(-1)">Prev</button>
                        <div style="font-weight: 700;" id="calMonthYear"></div>
                        <button class="btn btn-sm btn-secondary" onclick="changeCalMonth(1)">Next</button>
                    </div>
                    <div class="cal-grid" id="calGrid"></div>
                </div>
                <div style="background: var(--bg-body); padding: 1rem; border-radius: 8px; display:flex; flex-direction:column;">
                    <h4 style="margin-bottom: 1rem; color: var(--primary); border-bottom:1px solid var(--border); padding-bottom:0.5rem;" id="detailDate">Select a Date</h4>
                    <div id="dayDetails" class="activity-log-container">Click a date to view activity.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboarding-overlay">
        <div class="modal-box" style="max-width: 500px;">
            <h2 style="text-align: center; margin-bottom: 1rem; color: var(--primary);">Welcome to Achieve-mate! ðŸš€</h2>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Your personal productivity companion for better grades and skills.</p>
            
            <div class="step-card">
                <div class="step-icon"><i class="fas fa-book"></i></div>
                <div style="font-weight: 600; margin-bottom: 0.5rem;">1. Add Courses</div>
                <div style="font-size: 0.9rem; color: var(--text-muted);">Add your YouTube playlists or Udemy courses to track video progress easily.</div>
            </div>

            <div class="step-card">
                <div class="step-icon"><i class="fas fa-bullseye"></i></div>
                <div style="font-weight: 600; margin-bottom: 0.5rem;">2. Set Daily Goals</div>
                <div style="font-size: 0.9rem; color: var(--text-muted);">Create a checklist for today. Completing tasks boosts your consistency graph.</div>
            </div>

            <div class="step-card">
                <div class="step-icon"><i class="fas fa-stopwatch"></i></div>
                <div style="font-weight: 600; margin-bottom: 0.5rem;">3. Focus Mode</div>
                <div style="font-size: 0.9rem; color: var(--text-muted);">Use the Pomodoro timer to study without distractions and earn focus badges.</div>
            </div>

            <button class="btn btn-primary" style="width: 100%; font-size: 1.1rem;" onclick="closeOnboarding()">Let's Start!</button>
        </div>
    </div>

    <script>
        let appData = { playlists: [], dailyGoals: [], streak: 0, lastActiveDate: null, studyHistory: {}, focusHistory: [], totalFocusTime: 0, isNewUser: true };
        let calCursorDate = new Date();
        let selectedDateISO = new Date().toLocaleDateString('en-CA');
        let editingPlId = null;
        let focusInterval = null;
        let focusTimeLeft = 0;
        let currentBadgeFilter = 'all';
        
        // Course Filter State
        let currentCourseFilter = 'all';
        const courseFilters = ['all', 'active', 'completed'];
        
        // Swipe Vars
        let touchStartX = 0;
        let touchEndX = 0;
        let courseTouchStartX = 0;
        let courseTouchEndX = 0;

        function init() {
            const saved = localStorage.getItem('achieveMate_v8');
            if (saved) {
                appData = JSON.parse(saved);
            } else {
                // First time
                setTimeout(showOnboarding, 500);
            }
            updateGreeting();
            renderGoals(); renderPlaylists(); renderAchievements(); renderConsistencyGraph(); renderFocusHistory(); updateRecentVictory();
            document.getElementById('headerStreak').textContent = appData.streak;

            // Setup Calendar Swipe
            const calArea = document.getElementById('calSwipeArea');
            calArea.addEventListener('touchstart', e => touchStartX = e.changedTouches[0].screenX);
            calArea.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });

            // Setup Course Swipe
            const courseArea = document.getElementById('courseSwipeArea');
            courseArea.addEventListener('touchstart', e => courseTouchStartX = e.changedTouches[0].screenX);
            courseArea.addEventListener('touchend', e => {
                courseTouchEndX = e.changedTouches[0].screenX;
                handleCourseSwipe();
            });
        }
        
        function saveData() {
            localStorage.setItem('achieveMate_v8', JSON.stringify(appData));
            renderAchievements();
            updateRecentVictory();
        }

        function handleSwipe() {
            if (touchEndX < touchStartX - 50) changeCalMonth(1); // Left Swipe -> Next
            if (touchEndX > touchStartX + 50) changeCalMonth(-1); // Right Swipe -> Prev
        }

        function handleCourseSwipe() {
            let currentIndex = courseFilters.indexOf(currentCourseFilter);
            if (courseTouchEndX < courseTouchStartX - 50) {
                // Swipe Left -> Next Filter
                if (currentIndex < courseFilters.length - 1) {
                    const nextFilter = courseFilters[currentIndex + 1];
                    const btn = document.querySelectorAll('.course-tab')[currentIndex + 1];
                    filterCourses(nextFilter, btn);
                }
            }
            if (courseTouchEndX > courseTouchStartX + 50) {
                // Swipe Right -> Prev Filter
                if (currentIndex > 0) {
                    const prevFilter = courseFilters[currentIndex - 1];
                    const btn = document.querySelectorAll('.course-tab')[currentIndex - 1];
                    filterCourses(prevFilter, btn);
                }
            }
        }

        // Modified switchTab for Settings Toggle
        let currentActiveTab = 'dashboard';
        function switchTab(id) {
            if (id === 'settings' && currentActiveTab === 'settings') {
                id = 'dashboard'; 
            }
            
            currentActiveTab = id;
            document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
            document.getElementById(id + '-view').style.display = 'block';
            
            // Update Mobile Nav
            document.querySelectorAll('.mobile-nav-item').forEach(el => el.classList.remove('active'));
            const mobileItems = document.querySelectorAll('.mobile-nav-item');
            if(id=='dashboard') mobileItems[0].classList.add('active');
            if(id=='courses') mobileItems[1].classList.add('active');
            if(id=='goals') mobileItems[2].classList.add('active');
            if(id=='focus') mobileItems[3].classList.add('active');
            if(id=='achievements') mobileItems[4].classList.add('active');

            // Update Settings Icon State
            const settingsIcon = document.getElementById('mobileSettingsIcon');
            if(id === 'settings') settingsIcon.classList.add('active');
            else settingsIcon.classList.remove('active');

            // Update Desktop Sidebar
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const navItems = document.querySelectorAll('.nav-item');
            if(id=='dashboard') navItems[0].classList.add('active');
            if(id=='courses') navItems[1].classList.add('active');
            if(id=='goals') navItems[2].classList.add('active');
            if(id=='achievements') navItems[3].classList.add('active');
            if(id=='focus') navItems[4].classList.add('active');
            if(id=='settings') navItems[5].classList.add('active');
        }

        function toggleMobileSettings() {
            switchTab('settings');
        }

        function showOnboarding() { document.getElementById('onboarding-overlay').classList.add('active'); }
        function closeOnboarding() { 
            document.getElementById('onboarding-overlay').classList.remove('active'); 
            appData.isNewUser = false;
            saveData();
        }

        function updateGreeting() {
            const h = new Date().getHours();
            document.getElementById('greetingText').textContent = h < 12 ? "Good Morning!" : h < 18 ? "Good Afternoon!" : "Good Evening!";
            document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function updateStudyHistory(type, title, isAdding) {
            const today = new Date().toLocaleDateString('en-CA');
            if (!appData.studyHistory[today]) appData.studyHistory[today] = [];
            if (isAdding) {
                if(!appData.studyHistory[today].some(h => h.type === type && h.title === title))
                    appData.studyHistory[today].push({type, title});
            } else {
                appData.studyHistory[today] = appData.studyHistory[today].filter(h => !(h.type === type && h.title === title));
                if (appData.studyHistory[today].length === 0) delete appData.studyHistory[today];
            }
            saveData();
        }

        function addGoal() {
            const val = document.getElementById('newGoalInput').value.trim();
            if (!val) return;
            appData.dailyGoals.push({ id: Date.now(), title: val, completed: false, date: new Date().toDateString() });
            document.getElementById('newGoalInput').value = '';
            saveData(); renderGoals();
        }
        function toggleGoal(id) {
            const g = appData.dailyGoals.find(x => x.id === id);
            if (g) { g.completed = !g.completed; updateStudyHistory('Goal', g.title, g.completed); if(g.completed) triggerConfetti(); saveData(); renderGoals(); }
        }
        function deleteGoal(id) { 
            const g = appData.dailyGoals.find(x => x.id === id);
            if(g) updateStudyHistory('Goal', g.title, false);
            appData.dailyGoals = appData.dailyGoals.filter(x => x.id !== id); 
            saveData(); renderGoals(); 
        }
        function renderGoals() {
            const today = new Date().toDateString();
            const todays = appData.dailyGoals.filter(g => g.date === today);
            const html = todays.map(g => `
                <div class="check-item ${g.completed?'checked':''}" onclick="toggleGoal(${g.id})">
                    <div class="check-circle"></div><span class="check-text" style="flex:1">${g.title}</span>
                    <i class="fas fa-trash" style="color:var(--danger); opacity:0.5;" onclick="event.stopPropagation(); deleteGoal(${g.id})"></i>
                </div>
            `).join('');
            document.getElementById('dashboardGoalsList').innerHTML = html || '<div style="text-align:center;color:var(--text-muted);padding:1rem;">No goals set for today.</div>';
            document.getElementById('fullGoalsList').innerHTML = html;
            updateStats(); renderConsistencyGraph();
        }

        function renderConsistencyGraph() {
            const container = document.getElementById('consistencyGraph'); container.innerHTML = '';
            const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
            for (let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const dateStr = d.toDateString();
                const goals = appData.dailyGoals.filter(g => g.date === dateStr);
                const pct = goals.length ? Math.round((goals.filter(g=>g.completed).length / goals.length)*100) : 0;
                
                container.innerHTML += `
                <div class="graph-col">
                    <div class="graph-tooltip">${pct}%</div>
                    <div class="graph-track">
                        <div class="graph-bar" style="height:${pct}%"></div>
                    </div>
                    <div class="graph-label">${dayNames[d.getDay()]}</div>
                </div>`;
            }
        }

        function togglePlaylist(id) {
            const el = document.getElementById('acc-' + id);
            const icon = document.getElementById('icon-' + id);
            if(el.classList.contains('open')) {
                el.classList.remove('open');
                icon.style.transform = 'rotate(0deg)';
                document.getElementById('card-' + id).classList.remove('expanded');
            } else {
                el.classList.add('open');
                icon.style.transform = 'rotate(180deg)';
                document.getElementById('card-' + id).classList.add('expanded');
            }
        }
        function savePlaylist(e) {
            e.preventDefault();
            const videos = document.getElementById('plVideos').value.split('\n').filter(v=>v.trim()).map(v=>({id:Date.now()+Math.random(), title:v, completed:false}));
            appData.playlists.push({ id: Date.now(), name: document.getElementById('plName').value, source: document.getElementById('plSource').value, url:document.getElementById('plUrl').value, videos });
            saveData(); closeModal('addPlaylistModal'); 
            document.getElementById('addCourseForm').reset(); // Reset Form
            renderPlaylists();
        }
        
        function toggleVideo(plId, vId) {
            const pl = appData.playlists.find(p=>p.id===plId);
            const v = pl.videos.find(x=>x.id===vId);
            v.completed = !v.completed;
            
            updateStudyHistory('Study', `${pl.name}: ${v.title}`, v.completed);
            if(v.completed) { updateStreak(); triggerConfetti(); }
            saveData();
            
            const checkItem = document.getElementById(`vid-item-${plId}-${vId}`);
            if(checkItem) { if(v.completed) checkItem.classList.add('checked'); else checkItem.classList.remove('checked'); }
            
            const total = pl.videos.length;
            const done = pl.videos.filter(x=>x.completed).length;
            const pct = total ? Math.round((done/total)*100) : 0;
            
            const headerBar = document.getElementById(`prog-bar-${plId}`);
            const headerText = document.getElementById(`prog-text-${plId}`);
            if(headerBar) headerBar.style.width = `${pct}%`;
            if(headerText) headerText.innerText = `${pct}%`;
            
            const meta = document.getElementById(`pl-meta-${plId}`);
            if(meta) meta.innerHTML = `<i class="fas fa-play-circle"></i> ${done} / ${total} Completed`;
            updateStats();
        }

        function filterCourses(filter, btn) {
            currentCourseFilter = filter;
            document.querySelectorAll('.course-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const container = document.getElementById('playlistsContainer');
            container.classList.remove('fade-slide');
            void container.offsetWidth;
            container.classList.add('fade-slide');
            renderPlaylists();
        }

        function renderPlaylists() {
            const container = document.getElementById('playlistsContainer'); 
            container.innerHTML = '';
            
            let filteredList = appData.playlists;
            if (currentCourseFilter === 'active') {
                filteredList = appData.playlists.filter(pl => {
                    const done = pl.videos.filter(v => v.completed).length;
                    return done > 0 && done < pl.videos.length; // Modified Logic
                });
            } else if (currentCourseFilter === 'completed') {
                filteredList = appData.playlists.filter(pl => {
                    const done = pl.videos.filter(v => v.completed).length;
                    return done === pl.videos.length && pl.videos.length > 0;
                });
            }

            if (filteredList.length === 0) {
                container.innerHTML = `<div style="text-align:center; color:var(--text-muted); grid-column: 1/-1; padding: 2rem;">No courses found in this category.</div>`;
                return;
            }

            filteredList.forEach(pl => {
                const total = pl.videos.length;
                const done = pl.videos.filter(v=>v.completed).length;
                const pct = total ? Math.round((done/total)*100) : 0;
                
                container.innerHTML += `
                <div class="course-card" id="card-${pl.id}">
                    <div class="course-header" onclick="togglePlaylist(${pl.id})">
                        <div class="course-header-top">
                            <div class="course-title">
                                <i class="fas fa-chevron-down" id="icon-${pl.id}"></i>
                                ${pl.name}
                            </div>
                            <div class="course-badge">${pl.source}</div>
                        </div>
                        <div class="course-meta" id="pl-meta-${pl.id}"><i class="fas fa-play-circle"></i> ${done} / ${total} Completed</div>
                        <div class="course-edit-btn" onclick="event.stopPropagation(); openEditPlaylist(${pl.id})"><i class="fas fa-edit"></i></div>
                    </div>
                    <div class="course-progress-area">
                        <div class="progress-bar-bg"><div class="progress-bar-fill" id="prog-bar-${pl.id}" style="width:${pct}%"></div></div>
                        <div class="progress-text"><span>Progress</span><span id="prog-text-${pl.id}">${pct}%</span></div>
                    </div>
                    <div class="video-accordion" id="acc-${pl.id}">
                        ${pl.videos.map(v => `
                            <div class="check-item ${v.completed?'checked':''}" id="vid-item-${pl.id}-${v.id}" onclick="toggleVideo(${pl.id}, ${v.id})">
                                <div class="check-circle"></div>
                                <span class="check-text" style="flex:1">${v.title}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            });
        }

        function openEditPlaylist(id) {
            editingPlId = id;
            const pl = appData.playlists.find(p=>p.id===id);
            document.getElementById('editPlName').value = pl.name;
            document.getElementById('editPlVideos').value = pl.videos.map(v=>v.title).join('\n');
            openModal('editPlaylistModal');
        }
        function saveEditedPlaylist() {
            const pl = appData.playlists.find(p=>p.id===editingPlId);
            pl.name = document.getElementById('editPlName').value;
            const newTitles = document.getElementById('editPlVideos').value.split('\n').filter(l=>l.trim());
            pl.videos = newTitles.map(t => {
                const existing = pl.videos.find(v => v.title === t);
                return existing ? existing : { id:Date.now()+Math.random(), title:t, completed:false };
            });
            saveData(); renderPlaylists(); closeModal('editPlaylistModal');
        }
        function deletePlaylist() {
            if(confirm('Delete playlist?')) { appData.playlists = appData.playlists.filter(p=>p.id!==editingPlId); saveData(); renderPlaylists(); closeModal('editPlaylistModal'); }
        }

        const badgeList = [
            {id:'s3', cat:'streak', n:'Streak 3', d:'3 Day Streak', t:3, c:d=>d.streak},
            {id:'s7', cat:'streak', n:'Streak 7', d:'7 Day Streak', t:7, c:d=>d.streak},
            {id:'s30', cat:'streak', n:'Streak 30', d:'30 Day Streak', t:30, c:d=>d.streak},
            {id:'s50', cat:'streak', n:'Streak 50', d:'50 Day Streak', t:50, c:d=>d.streak},
            {id:'s100', cat:'streak', n:'Streak 100', d:'100 Day Streak', t:100, c:d=>d.streak},
            {id:'s150', cat:'streak', n:'Streak 150', d:'150 Day Streak', t:150, c:d=>d.streak},
            {id:'s200', cat:'streak', n:'Streak 200', d:'200 Day Streak', t:200, c:d=>d.streak},
            {id:'s365', cat:'streak', n:'Legend', d:'365 Day Streak', t:365, c:d=>d.streak},
            {id:'p1', cat:'playlist', n:'Creator', d:'Create 1 Playlist', t:1, c:d=>d.playlists.length},
            {id:'pf1', cat:'playlist', n:'Finisher', d:'Complete 1 Playlist', t:1, c:d=>d.playlists.filter(p=>p.videos.length>0&&p.videos.every(v=>v.completed)).length},
            {id:'pf5', cat:'playlist', n:'Pro', d:'Complete 5 Playlists', t:5, c:d=>d.playlists.filter(p=>p.videos.length>0&&p.videos.every(v=>v.completed)).length},
            {id:'pf10', cat:'playlist', n:'Expert', d:'Complete 10 Playlists', t:10, c:d=>d.playlists.filter(p=>p.videos.length>0&&p.videos.every(v=>v.completed)).length},
            {id:'pf25', cat:'playlist', n:'Master', d:'Complete 25 Playlists', t:25, c:d=>d.playlists.filter(p=>p.videos.length>0&&p.videos.every(v=>v.completed)).length},
            {id:'f5', cat:'focus', n:'Focus 5', d:'5 Hours Focus', t:300, c:d=>d.totalFocusTime},
            {id:'f10', cat:'focus', n:'Focus 10', d:'10 Hours Focus', t:600, c:d=>d.totalFocusTime},
            {id:'f25', cat:'focus', n:'Focus 25', d:'25 Hours Focus', t:1500, c:d=>d.totalFocusTime},
            {id:'f50', cat:'focus', n:'Focus 50', d:'50 Hours Focus', t:3000, c:d=>d.totalFocusTime}
        ];

        function filterBadges(type, btn) {
            currentBadgeFilter = type;
            document.querySelectorAll('.ach-filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderAchievements();
        }

        function renderAchievements() {
            let unlocked = 0;
            const grid = document.getElementById('achievementsGrid'); grid.innerHTML = '';
            
            const badgesWithData = badgeList.map(b => {
                const current = b.c(appData);
                const earned = current >= b.t;
                const pct = Math.min(100, Math.round((current/b.t)*100));
                return { ...b, earned, current, pct };
            });

            unlocked = badgesWithData.filter(b=>b.earned).length;
            document.getElementById('achieveCount').textContent = unlocked;

            let displayBadges = badgesWithData;
            if(currentBadgeFilter !== 'all') displayBadges = displayBadges.filter(b => b.cat === currentBadgeFilter);
            displayBadges.sort((a, b) => (a.earned === b.earned) ? 0 : a.earned ? -1 : 1);

            grid.innerHTML = displayBadges.map(b => `
                <div class="ach-card ${b.earned?'earned':''}">
                    <div class="ach-icon"><i class="fas fa-trophy"></i></div>
                    <div style="flex:1">
                        <div style="font-weight:600">${b.n}</div>
                        <div style="font-size:0.8rem;color:var(--text-muted)">${b.d}</div>
                        ${!b.earned ? `
                        <div class="badge-progress-wrapper">
                            <div class="badge-progress-text"><span>Progress</span><span>${b.current}/${b.t}</span></div>
                            <div class="badge-progress-bg"><div class="badge-progress-fill" style="width:${b.pct}%"></div></div>
                        </div>` : '<div style="font-size:0.75rem;color:var(--success);margin-top:4px;"><i class="fas fa-check"></i> Unlocked</div>'}
                    </div>
                </div>
            `).join('');
        }

        function updateRecentVictory() {
            const badgesWithData = badgeList.map(b => {
                const current = b.c(appData);
                const earned = current >= b.t;
                return { ...b, earned };
            });
            const earnedBadges = badgesWithData.filter(b => b.earned);
            const content = document.getElementById('recentBadgeContent');
            
            if (earnedBadges.length > 0) {
                const recent = earnedBadges[earnedBadges.length - 1]; 
                content.innerHTML = `
                    <div style="font-size: 2rem; color: var(--accent);"><i class="fas fa-trophy"></i></div>
                    <div>
                        <div style="font-weight: 600;">${recent.n}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">${recent.d}</div>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div style="font-size: 2rem; color: var(--text-muted); opacity: 0.5;"><i class="fas fa-lock"></i></div>
                    <div>
                        <div style="font-weight: 600;">No Badges Yet</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">Start learning to unlock!</div>
                    </div>
                `;
            }
        }

        function setCustomTime(m) { document.getElementById('customFocusTime').value = m; }
        function startFullScreenFocus() {
            const mins = parseInt(document.getElementById('customFocusTime').value)||25;
            const task = document.getElementById('focusTaskInput').value||"Deep Work";
            focusTimeLeft = mins * 60;
            document.getElementById('overlayTask').textContent = task;
            document.getElementById('focus-overlay').classList.add('active');
            document.documentElement.requestFullscreen().catch(e=>{});
            updateTimer();
            focusInterval = setInterval(() => { focusTimeLeft--; updateTimer(); if(focusTimeLeft<=0) finishFocus(mins, task); }, 1000);
        }
        function updateTimer() {
            const m = Math.floor(focusTimeLeft/60); const s = focusTimeLeft%60;
            document.getElementById('overlayTimer').textContent = `${m}:${s.toString().padStart(2,'0')}`;
        }
        function stopFullScreenFocus() { clearInterval(focusInterval); document.getElementById('focus-overlay').classList.remove('active'); if(document.fullscreenElement) document.exitFullscreen(); }
        function finishFocus(mins, task) {
            stopFullScreenFocus(); alert('Session Complete!'); triggerConfetti();
            appData.totalFocusTime += mins; appData.focusHistory.unshift({date:new Date().toLocaleString(), task, duration:mins});
            updateStudyHistory('Focus', `${mins}m: ${task}`, true); saveData(); renderFocusHistory();
        }
        function renderFocusHistory() {
            document.getElementById('focusHistoryList').innerHTML = appData.focusHistory.map(f=>`<div style="border-bottom:1px solid var(--border);padding:0.5rem;"><b>${f.task}</b><div style="font-size:0.8rem;color:var(--text-muted)">${f.date} â€¢ ${f.duration}m</div></div>`).join('');
        }

        // --- CALENDAR FIXES ---
        function openCalendarModal() { 
            calCursorDate = new Date();
            selectedDateISO = new Date().toLocaleDateString('en-CA');
            openModal('calendarModal'); 
            renderCalendar();
            showDayDetails(selectedDateISO);
        }
        
        function changeCalMonth(d) { calCursorDate.setMonth(calCursorDate.getMonth()+d); renderCalendar(); }
        
        function renderCalendar() {
            const y = calCursorDate.getFullYear(); const m = calCursorDate.getMonth();
            document.getElementById('calMonthYear').textContent = calCursorDate.toLocaleString('default',{month:'long',year:'numeric'});
            const firstDay = new Date(y,m,1).getDay(); const daysInMonth = new Date(y,m+1,0).getDate();
            const grid = document.getElementById('calGrid'); grid.innerHTML = '';
            
            ['S','M','T','W','T','F','S'].forEach(d=>grid.innerHTML+=`<div style="text-align:center;font-size:0.8rem;color:var(--text-muted)">${d}</div>`);
            for(let i=0; i<firstDay; i++) grid.innerHTML+=`<div></div>`;
            
            for(let i=1; i<=daysInMonth; i++) {
                const iso = `${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                const hasData = appData.studyHistory[iso] && appData.studyHistory[iso].length > 0;
                const isToday = new Date().toDateString() === new Date(y,m,i).toDateString();
                const isSelected = iso === selectedDateISO;
                
                const div = document.createElement('div'); 
                div.className = `cal-day ${isToday?'today':''} ${isSelected?'selected':''}`;
                if(hasData) div.innerHTML = `<div class="cal-dot"></div>`;
                div.innerHTML += i;
                div.onclick = () => {
                    selectedDateISO = iso;
                    renderCalendar(); 
                    showDayDetails(iso);
                };
                grid.appendChild(div);
            }
        }
        
        function showDayDetails(iso) {
            const logs = appData.studyHistory[iso] || [];
            const d = new Date(iso); d.setMinutes(d.getMinutes() + d.getTimezoneOffset());
            document.getElementById('detailDate').textContent = d.toDateString();
            const container = document.getElementById('dayDetails');
            
            if(logs.length === 0) {
                container.innerHTML = `<div style="text-align:center; padding:20px; color:var(--text-muted);"><i class="fas fa-mug-hot" style="font-size:2rem; margin-bottom:10px;"></i><p>No activity recorded.</p></div>`;
                return;
            }

            // Separate Goals & Studies
            const goals = logs.filter(l => l.type === 'Goal');
            const studies = logs.filter(l => l.type === 'Study');

            // Group Studies by Course
            const studyGroups = {};
            studies.forEach(s => {
                const parts = s.title.split(':'); // "Course: Video"
                const courseName = parts[0].trim();
                const videoTitle = parts.slice(1).join(':').trim();
                if(!studyGroups[courseName]) studyGroups[courseName] = [];
                studyGroups[courseName].push(videoTitle);
            });

            let html = '';

            // Render Goals
            if (goals.length > 0) {
                html += `<div class="activity-group type-goal">
                    <div class="group-header" onclick="toggleGroup(this)">
                        <div class="group-title"><i class="fas fa-check-circle" style="color:var(--success)"></i> Completed Goals</div>
                        <div class="group-count">${goals.length}</div>
                    </div>
                    <div class="group-items">
                        ${goals.map(g => `<div class="group-item">${g.title}</div>`).join('')}
                    </div>
                </div>`;
            }

            // Render Study Groups
            for (const [course, videos] of Object.entries(studyGroups)) {
                html += `<div class="activity-group type-study">
                    <div class="group-header" onclick="toggleGroup(this)">
                        <div class="group-title"><i class="fas fa-book" style="color:var(--primary)"></i> ${course}</div>
                        <div class="group-count">${videos.length} Topics</div>
                    </div>
                    <div class="group-items">
                        ${videos.map(v => `<div class="group-item">${v}</div>`).join('')}
                    </div>
                </div>`;
            }

            container.innerHTML = html;
        }

        function toggleGroup(header) {
            const items = header.nextElementSibling;
            items.classList.toggle('show');
        }

        function updateStreak() {
            const today = new Date().toDateString();
            if(appData.lastActiveDate !== today) {
                const yest = new Date(); yest.setDate(yest.getDate()-1);
                if(appData.lastActiveDate === yest.toDateString()) appData.streak++; else appData.streak = 1;
                appData.lastActiveDate = today; saveData();
                document.getElementById('headerStreak').textContent = appData.streak;
            }
        }
        function updateStats() {
            const t = appData.dailyGoals.filter(g=>g.date===new Date().toDateString());
            const d = t.filter(g=>g.completed).length;
            document.getElementById('goalPct').textContent = t.length ? Math.round((d/t.length)*100)+'%' : '0%';
            
            let totalV = 0, doneV = 0;
            appData.playlists.forEach(p => { totalV += p.videos.length; doneV += p.videos.filter(v=>v.completed).length; });
            document.getElementById('topicPct').textContent = totalV ? Math.round((doneV/totalV)*100)+'%' : '0%';
        }
        function contactDeveloper() {
            window.location.href = "mailto:thedeepkjha4u@gmail.com?subject=Achieve-mate%20Feedback&body=Hi%20Deepak,%0A%0AI%20want%20to%20share%20my%20experience%20or%20report%20a%20bug:%0A%0A";
        }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function triggerConfetti() { for(let i=0;i<30;i++){ const c=document.createElement('div');c.className='confetti';c.style.left=Math.random()*100+'vw';c.style.background=['#f00','#0f0','#00f','#ff0'][Math.floor(Math.random()*4)];c.style.animation=`confetti-fall ${2+Math.random()*2}s linear`;document.body.appendChild(c);setTimeout(()=>c.remove(),4000); } }
        function exportData() { const a=document.createElement('a');a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(appData));a.download="backup.json";document.body.appendChild(a);a.click();a.remove(); }
        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    appData = JSON.parse(e.target.result);
                    saveData();
                    init();
                    alert("Data imported successfully!");
                } catch (err) {
                    alert("Invalid file format.");
                }
            };
            reader.readAsText(file);
        }
        function clearData() { if(confirm('Reset all data? This cannot be undone.')) { localStorage.removeItem('achieveMate_v8'); location.reload(); } }

        init();
    </script>
</body>
</html>
