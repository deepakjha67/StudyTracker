<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Achieve-mate | Student Productivity</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --bg-sidebar: #0f172a; 
            
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --accent: #fbbf24;
            --success: #10b981;
            --danger: #ef4444;
            
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            
            --radius-lg: 16px;
            --radius-md: 12px;
            
            --font-main: 'Inter', sans-serif;
            --font-heading: 'Poppins', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; scrollbar-width: thin; scrollbar-color: var(--border) var(--bg-body); }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: var(--font-main); line-height: 1.6; overflow-x: hidden; }

        .app-wrapper { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 1.5rem; position: fixed; height: 100vh; z-index: 50; transition: transform 0.3s ease; }
        .brand { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2.5rem; color: var(--primary); font-family: var(--font-heading); font-weight: 700; font-size: 1.25rem; }
        
        .nav-item { display: flex; align-items: center; gap: 1rem; padding: 0.875rem 1rem; border-radius: var(--radius-md); color: var(--text-muted); cursor: pointer; transition: all 0.2s ease; font-weight: 500; margin-bottom: 0.5rem; border-left: 3px solid transparent; }
        .nav-item:hover { background: var(--bg-card-hover); color: var(--text-main); }
        .nav-item.active { background: rgba(99, 102, 241, 0.1); color: var(--primary); border-left-color: var(--primary); box-shadow: 0 0 15px rgba(99, 102, 241, 0.1); }

        /* Credits Section in Sidebar */
        .sidebar-footer { margin-top: auto; padding-top: 1.5rem; border-top: 1px solid var(--border); text-align: center; font-size: 0.8rem; color: var(--text-muted); }
        .creator-link { color: var(--accent); text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; margin-top: 5px; transition: color 0.2s; }
        .creator-link:hover { color: var(--primary); }

        /* Main Content */
        .main-content { flex: 1; margin-left: 260px; padding: 2rem; max-width: 1600px; padding-bottom: 100px; }

        /* Mobile Nav */
        .mobile-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-card); border-top: 1px solid var(--border); padding: 0 1rem; justify-content: space-around; z-index: 100; padding-bottom: env(safe-area-inset-bottom); height: 70px; align-items: center; }
        .mobile-nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-muted); font-size: 0.7rem; padding: 8px 16px; cursor: pointer; transition: all 0.2s; border-radius: 12px; position: relative; }
        .mobile-nav-item i { font-size: 1.3rem; margin-bottom: 2px; transition: transform 0.2s; }
        .mobile-nav-item.active { color: #fff; }
        .mobile-nav-item.active i { color: var(--primary); transform: translateY(-2px); }
        .mobile-nav-item.active::after { content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 20px; height: 4px; background: var(--primary); border-radius: 0 0 4px 4px; box-shadow: 0 0 10px var(--primary); }

        /* Header */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .greeting h1 { font-family: var(--font-heading); font-size: 1.75rem; font-weight: 600; line-height: 1.2; }
        
        .streak-badge { display: flex; align-items: center; gap: 0.75rem; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.2); padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; transition: transform 0.2s; white-space: nowrap; height: fit-content; }
        .streak-count { font-weight: 700; color: var(--accent); font-size: 1.1rem; }
        
        .header-login-btn { background: var(--primary); color: white; padding: 0.5rem 1.2rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3); transition: transform 0.2s; }
        .header-login-btn:hover { transform: translateY(-2px); background: var(--primary-hover); }

        /* Common Components */
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1.5rem; }
        .card-title { font-family: var(--font-heading); font-size: 1.1rem; font-weight: 600; margin-bottom: 1.25rem; display: flex; align-items: center; justify-content: space-between; color: var(--text-main); }
        
        .btn { border: none; outline: none; cursor: pointer; font-family: var(--font-main); font-weight: 500; border-radius: var(--radius-md); padding: 0.75rem 1.5rem; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.95rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--bg-card-hover); color: var(--text-main); border: 1px solid var(--border); }
        .btn-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.2); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .btn-icon-only { padding: 0.5rem; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-muted); background: transparent; }
        .btn-icon-only:hover { background: var(--bg-card-hover); color: var(--text-main); }
        .btn-google { background: #ffffff; color: #333; width: 100%; margin-bottom: 1rem; border: 1px solid #ddd; }
        .btn-google:hover { background: #f1f1f1; }
        
        /* Special Link Button Style */
        .btn-link-external { color: var(--accent); border: 1px solid rgba(251, 191, 36, 0.2); background: rgba(251, 191, 36, 0.05); }
        .btn-link-external:hover { background: rgba(251, 191, 36, 0.1); color: #fff; border-color: var(--accent); }

        input, select, textarea { width: 100%; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); padding: 0.75rem 1rem; border-radius: var(--radius-md); font-family: var(--font-main); font-size: 0.95rem; }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        /* Auth Specific */
        .auth-container { width: 100%; max-width: 400px; text-align: center; }
        .auth-tabs { display: flex; margin-bottom: 1.5rem; background: var(--bg-body); padding: 5px; border-radius: 10px; }
        .auth-tab { flex: 1; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 500; color: var(--text-muted); transition: all 0.2s; }
        .auth-tab.active { background: var(--bg-card); color: var(--text-main); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* Password Wrapper for Eye Icon */
        .password-wrapper { position: relative; width: 100%; margin-bottom: 0.5rem; }
        .password-wrapper input { width: 100%; padding-right: 40px; } 
        .password-toggle { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-muted); z-index: 10; }
        .password-toggle:hover { color: var(--primary); }

        /* Divider */
        .auth-divider { display: flex; align-items: center; text-align: center; margin: 1rem 0; color: var(--text-muted); font-size: 0.8rem; }
        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--border); }
        .auth-divider::before { margin-right: .5em; }
        .auth-divider::after { margin-left: .5em; }

        /* Grids */
        .grid-dashboard { display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 1.5rem; }
        .grid-profile { display: grid; grid-template-columns: 320px 1fr; gap: 1.5rem; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }

        /* Priority List */
        .priority-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-body); border: 1px solid var(--border); border-radius: var(--radius-md); transition: all 0.2s; cursor: pointer; margin-bottom: 0.75rem; }
        .priority-item:hover { border-color: var(--primary); transform: translateX(4px); }
        .priority-item.checked .priority-text { text-decoration: line-through; color: var(--text-muted); }
        .priority-checkbox { width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--text-muted); display: flex; align-items: center; justify-content: center; color: transparent; }
        .priority-item.checked .priority-checkbox { background: var(--success); border-color: var(--success); color: white; }

        /* Graph */
        .graph-container { display: flex; justify-content: space-between; align-items: flex-end; height: 180px; padding: 20px 10px 5px 10px; background: linear-gradient(to bottom, rgba(30,41,59,0.3), rgba(15,23,42,0.3)); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .graph-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; height: 100%; justify-content: flex-end; }
        .graph-bar { width: 10px; background: linear-gradient(180deg, var(--primary) 0%, var(--primary-hover) 100%); border-radius: 20px; transition: height 0.8s; min-height: 4px; }
        .graph-label { font-size: 0.65rem; color: var(--text-muted); }

        /* Calendar */
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9rem; font-weight: 700; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .cal-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 0.8rem; cursor: pointer; border: 1px solid transparent; position: relative; }
        .cal-day:hover { background: var(--bg-card-hover); border-color: var(--primary); }
        .cal-day.today { color: var(--accent); font-weight: bold; border-color: var(--accent); }
        .cal-day.has-data .cal-dot { width: 4px; height: 4px; border-radius: 50%; background: var(--success); position: absolute; bottom: 4px; }

        /* Activity Log Groups */
        .activity-group { background: var(--bg-card-hover); border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--text-muted); overflow: hidden; }
        .activity-group.type-study { border-color: var(--primary); }
        .activity-group.type-goal { border-color: var(--success); }
        .group-header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 0.9rem; font-weight: 600; }
        .group-items { padding: 0 15px 10px 15px; display: none; font-size: 0.85rem; color: var(--text-muted); }
        .group-items.show { display: block; }

        /* Courses */
        .courses-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 1.5rem; }
        .course-filter-container { display: flex; gap: 10px; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        .course-tab { background: none; border: none; color: var(--text-muted); font-weight: 600; font-size: 0.95rem; cursor: pointer; padding: 0.5rem 1rem; border-radius: 20px; transition: all 0.2s; }
        .course-tab.active { background: var(--bg-card-hover); color: var(--text-main); }
        
        .course-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; transition: all 0.3s ease; display: flex; flex-direction: column; position: relative; }
        .course-card:hover { transform: translateY(-4px); border-color: var(--primary); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        .course-header { padding: 1.5rem; background: linear-gradient(to bottom right, rgba(30,41,59,1), rgba(15,23,42,1)); border-bottom: 1px solid var(--border); position: relative; cursor: pointer; }
        .course-header-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; margin-bottom: 0.5rem; }
        .course-badge { font-size: 0.7rem; padding: 0.25rem 0.75rem; border-radius: 20px; background: rgba(99, 102, 241, 0.1); color: var(--primary); border: 1px solid rgba(99, 102, 241, 0.2); font-weight: 600; text-transform: uppercase; }
        .course-title { font-family: var(--font-heading); font-size: 1.15rem; font-weight: 600; line-height: 1.4; display: flex; align-items: center; gap: 8px; flex: 1; }
        .course-meta { font-size: 0.85rem; color: var(--text-muted); display: flex; gap: 1rem; margin-top: 0.5rem; }
        .course-progress-area { padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .progress-text { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); font-weight: 500; margin-top: 5px; }
        .video-accordion { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; background: var(--bg-card); }
        .video-accordion.open { max-height: 400px; overflow-y: auto; }
        
        /* Course Edit & Link Buttons */
        .course-actions-container { position: absolute; bottom: 15px; right: 15px; z-index: 5; display: flex; gap: 8px; }
        .course-edit-btn { background: var(--bg-card-hover); color: var(--text-muted); border: 1px solid var(--border); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .course-edit-btn:hover { color: var(--text-main); border-color: var(--text-muted); transform: translateY(-2px); }

        /* Awards Grid */
        .ach-filters { display: flex; gap: 10px; margin-bottom: 1.5rem; overflow-x: auto; white-space: nowrap; padding-bottom: 5px; }
        .ach-filter-btn { padding: 0.4rem 1rem; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-muted); cursor: pointer; font-size: 0.85rem; }
        .ach-filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; }
        .ach-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.25rem; display: flex; gap: 1rem; align-items: center; opacity: 0.5; filter: grayscale(1); transition: all 0.3s; position: relative; }
        .ach-card.earned { opacity: 1; filter: grayscale(0); border-color: var(--accent); background: linear-gradient(135deg, var(--bg-card), rgba(251, 191, 36, 0.05)); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .ach-icon { font-size: 1.8rem; color: var(--text-muted); min-width: 50px; text-align: center; }
        .ach-card.earned .ach-icon { color: var(--accent); text-shadow: 0 0 10px rgba(251,191,36,0.4); }
        .ach-info h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .ach-info p { font-size: 0.75rem; color: var(--text-muted); }
        .ach-progress { height: 4px; background: rgba(255,255,255,0.1); margin-top: 8px; border-radius: 2px; overflow: hidden; }
        .ach-fill { height: 100%; background: var(--primary); width: 0%; }

        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
        .modal-box { background: var(--bg-card); width: 90%; max-width: 600px; border-radius: var(--radius-lg); border: 1px solid var(--border); padding: 2rem; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-lg { max-width: 800px; }

        /* Onboarding Dots */
        .guide-step { margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: flex-start; }
        .guide-icon { width: 40px; height: 40px; background: rgba(99,102,241,0.2); color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes confetti { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .confetti { position: fixed; top: 0; width: 8px; height: 8px; z-index: 2000; pointer-events: none; }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .main-content { margin-left: 0; padding: 1.25rem; padding-bottom: 100px; }
            .mobile-nav { display: flex; }
            .grid-dashboard, .grid-profile, .grid-2, .courses-grid { grid-template-columns: 1fr; }
            .page-header { flex-direction: row; }
            .greeting h1 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <!-- Auth Overlay -->
    <div id="auth-overlay" class="modal-overlay">
        <div class="modal-box auth-container">
            <div style="display:flex; justify-content:flex-end;"><button class="btn-icon-only" onclick="document.getElementById('auth-overlay').classList.remove('active')">âœ•</button></div>
            <h2 style="margin-bottom: 1rem; color: var(--primary);">Achieve-mate</h2>
            <div class="auth-tabs">
                <div class="auth-tab active" id="tab-login" onclick="toggleAuthMode('login')">Login</div>
                <div class="auth-tab" id="tab-signup" onclick="toggleAuthMode('signup')">Sign Up</div>
            </div>
            
            <!-- Google Login Button -->
            <button class="btn btn-google" onclick="window.handleGoogleAuth()">
                <i class="fab fa-google" style="margin-right: 8px;"></i> Continue with Google
            </button>

            <div class="auth-divider">OR</div>

            <form id="auth-form">
                <input type="email" id="auth-email" placeholder="Email Address" required style="margin-bottom: 1rem;">
                
                <!-- Password Wrapper for Eye Icon -->
                <div class="password-wrapper">
                    <input type="password" id="auth-password" placeholder="Password" required>
                    <i class="fas fa-eye password-toggle" id="togglePassword" onclick="window.togglePasswordVisibility()"></i>
                </div>
                
                <!-- FORGOT PASSWORD LINK -->
                <div style="text-align:right; margin-bottom:1.5rem;" id="forgot-pass-container">
                    <button type="button" onclick="window.handleResetPassword()" style="background:none; border:none; font-size:0.8rem; color:var(--text-muted); cursor:pointer; text-decoration:underline;">Forgot Password?</button>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;" id="auth-btn">Login</button>
            </form>
            <div id="auth-msg" style="margin-top: 1rem; font-size: 0.85rem; color: var(--danger);"></div>
            <div style="margin-top: 1.5rem; font-size: 0.8rem; color: var(--text-muted);">
                <a href="#" onclick="document.getElementById('auth-overlay').classList.remove('active')" style="color: var(--accent);">Continue as Guest (Offline)</a>
            </div>
        </div>
    </div>

    <!-- Welcome Guide Modal -->
    <div id="welcome-overlay" class="modal-overlay">
        <div class="modal-box" style="max-width: 500px;">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--primary);">Welcome to Achieve-mate! ðŸš€</h2>
            <div class="guide-step">
                <div class="guide-icon"><i class="fas fa-home"></i></div>
                <div>
                    <h4 style="margin-bottom:0.2rem">Dashboard</h4>
                    <p style="font-size:0.9rem; color:var(--text-muted)">Track daily priorities and see your progress at a glance.</p>
                </div>
            </div>
            <div class="guide-step">
                <div class="guide-icon"><i class="fas fa-play-circle"></i></div>
                <div>
                    <h4 style="margin-bottom:0.2rem">Courses</h4>
                    <p style="font-size:0.9rem; color:var(--text-muted)">Create custom learning playlists and track topics.</p>
                </div>
            </div>
            <div class="guide-step">
                <div class="guide-icon"><i class="fas fa-clock"></i></div>
                <div>
                    <h4 style="margin-bottom:0.2rem">Focus Mode</h4>
                    <p style="font-size:0.9rem; color:var(--text-muted)">Distraction-free timer to boost your deep work sessions.</p>
                </div>
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="closeWelcomeGuide()">Let's Get Started!</button>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <div class="mobile-nav-item active" id="mob-dashboard" onclick="switchTab('dashboard')"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="mobile-nav-item" id="mob-courses" onclick="switchTab('courses')"><i class="fas fa-book"></i><span>Courses</span></div>
        <div class="mobile-nav-item" id="mob-focus" onclick="switchTab('focus')"><i class="fas fa-clock"></i><span>Focus</span></div>
        <div class="mobile-nav-item" id="mob-achievements" onclick="switchTab('achievements')"><i class="fas fa-trophy"></i><span>Awards</span></div>
        <div class="mobile-nav-item" id="mob-profile" onclick="switchTab('profile')"><i class="fas fa-user"></i><span>Profile</span></div>
    </nav>

    <div class="app-wrapper">
        <aside class="sidebar">
            <div class="brand"><i class="fas fa-graduation-cap"></i><span>Achieve-mate</span></div>
            <div class="nav-item active" id="nav-dashboard" onclick="switchTab('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-item" id="nav-courses" onclick="switchTab('courses')"><i class="fas fa-play-circle"></i> My Courses</div>
            <div class="nav-item" id="nav-focus" onclick="switchTab('focus')"><i class="fas fa-stopwatch"></i> Focus Mode</div>
            <div class="nav-item" id="nav-achievements" onclick="switchTab('achievements')"><i class="fas fa-trophy"></i> Achievements</div>
            <div class="nav-item" id="nav-profile" onclick="switchTab('profile')"><i class="fas fa-user-circle"></i> Profile</div>
            
            <!-- CREATOR CREDITS SECTION -->
            <div class="sidebar-footer">
                <div>Built by Developer</div>
                <a href="https://www.linkedin.com/in/your-profile-link" target="_blank" class="creator-link">
                    <i class="fab fa-linkedin"></i> Connect
                </a>
            </div>
        </aside>

        <main class="main-content">
            <header class="page-header">
                <div class="header-left">
                    <div class="greeting">
                        <h1 id="greetingText">Good Morning!</h1>
                        <p id="dateDisplay" style="color:var(--text-muted); font-size:0.9rem;">Loading...</p>
                    </div>
                </div>
                <div class="header-right">
                    <button id="headerLoginBtn" class="header-login-btn" onclick="document.getElementById('auth-overlay').classList.add('active')">
                        <i class="fas fa-sign-in-alt"></i> Login / Sync
                    </button>
                    <div class="streak-badge" onclick="switchTab('profile')">
                        <i class="fas fa-fire" style="color: var(--accent)"></i>
                        <div class="streak-count" id="headerStreak">0</div>
                    </div>
                </div>
            </header>

            <!-- DASHBOARD -->
            <div id="dashboard-view" class="view-section">
                <div class="grid-dashboard">
                    <!-- Left: Tasks & Graph -->
                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div class="card">
                            <div class="card-title">
                                <span><i class="fas fa-tasks"></i> Today's Priority</span>
                                <button class="btn-icon-only" onclick="openModal('manageGoalsModal')"><i class="fas fa-pencil-alt"></i></button>
                            </div>
                            <div id="dashboardGoalsList"></div>
                            <div id="emptyGoalsMsg" style="text-align:center; color:var(--text-muted); padding:1rem; font-size:0.9rem; display:none;">No tasks set. Tap the pencil to add.</div>
                        </div>
                        <div class="card">
                            <div class="card-title"><i class="fas fa-chart-bar"></i> 7-Day Consistency</div>
                            <div class="graph-container" id="consistencyGraph"></div>
                        </div>
                    </div>

                    <!-- Right: Stats -->
                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div class="card">
                            <div class="card-title"><i class="fas fa-chart-line"></i> Progress</div>
                            <div style="display: flex; justify-content: space-around; text-align: center; padding: 10px 0;">
                                <div style="cursor: pointer;" onclick="switchTab('courses')">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent);" id="topicPct">0%</div>
                                    <div style="font-size: 0.9rem; color: var(--text-muted);">Courses</div>
                                </div>
                                <div style="cursor: pointer;" onclick="openModal('manageGoalsModal')">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent);" id="goalPct">0%</div>
                                    <div style="font-size: 0.9rem; color: var(--text-muted);">Goals</div>
                                </div>
                            </div>
                        </div>
                        <div class="card" onclick="switchTab('achievements')" style="cursor:pointer; background: linear-gradient(135deg, var(--bg-card), rgba(251, 191, 36, 0.1)); border-color: rgba(251, 191, 36, 0.3);">
                            <div class="card-title" style="color: var(--accent);"><i class="fas fa-crown"></i> Recent Victory</div>
                            <div id="recentBadgeContent">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COURSES -->
            <div id="courses-view" class="view-section" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 style="font-family: var(--font-heading);">Learning Playlists</h2>
                        <button class="btn btn-primary" onclick="openModal('addPlaylistModal')"><i class="fas fa-plus"></i> Add Course</button>
                    </div>
                    <div class="course-filter-container">
                        <button class="course-tab active" onclick="filterCourses('all', this)">All</button>
                        <button class="course-tab" onclick="filterCourses('active', this)">In Progress</button>
                        <button class="course-tab" onclick="filterCourses('completed', this)">Completed</button>
                    </div>
                    <div id="playlistsContainer" class="courses-grid"></div>
                </div>
            </div>

            <!-- FOCUS -->
            <div id="focus-view" class="view-section" style="display: none;">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-title" style="justify-content: center;">Focus Session</div>
                        <input type="text" id="focusTaskInput" placeholder="What are you working on?" style="text-align: center; margin-bottom: 1.5rem;">
                        <label style="display:block; text-align:center; color:var(--text-muted); margin-bottom:0.5rem;">Duration (Minutes)</label>
                        <input type="number" id="customFocusTime" value="25" style="text-align:center; margin-bottom:1rem; width:80px; margin-left:auto; margin-right:auto; display:block;">
                        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 1.5rem;">
                            <button class="btn btn-secondary btn-sm" onclick="document.getElementById('customFocusTime').value=25">25m</button>
                            <button class="btn btn-secondary btn-sm" onclick="document.getElementById('customFocusTime').value=45">45m</button>
                            <button class="btn btn-secondary btn-sm" onclick="document.getElementById('customFocusTime').value=60">60m</button>
                        </div>
                        <button class="btn btn-primary" style="width:100%" onclick="startFullScreenFocus()">Start Focus</button>
                    </div>
                    <div class="card">
                        <div class="card-title">Recent Sessions</div>
                        <div id="focusHistoryList" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>

            <!-- AWARDS -->
            <div id="achievements-view" class="view-section" style="display: none;">
                <div class="card">
                    <div class="card-title">
                        <span>Badges & Milestones</span>
                        <span id="badgeCount" style="color:var(--accent)">0 / 17</span>
                    </div>
                    <div class="ach-filters">
                        <button class="ach-filter-btn active" onclick="filterBadges('all', this)">All</button>
                        <button class="ach-filter-btn" onclick="filterBadges('streak', this)">Streak</button>
                        <button class="ach-filter-btn" onclick="filterBadges('playlist', this)">Courses</button>
                        <button class="ach-filter-btn" onclick="filterBadges('focus', this)">Focus</button>
                    </div>
                    <div class="achievements-grid" id="achievementsGrid"></div>
                </div>
            </div>

            <!-- PROFILE -->
            <div id="profile-view" class="view-section" style="display: none;">
                <div class="card" style="display:flex; align-items:center; gap:1.5rem; background: linear-gradient(to right, var(--bg-card), rgba(99,102,241,0.1));">
                    <div style="width:70px; height:70px; border-radius:50%; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:700;" id="profilePic">U</div>
                    <div>
                        <h2 id="profileName" style="line-height:1.2">Guest User</h2>
                        <p id="profileEmail" style="color:var(--text-muted); font-size:0.9rem;">Not logged in</p>
                        <p id="verificationStatus" style="color:var(--accent); font-size:0.8rem; display:none;">Email not verified</p>
                    </div>
                </div>

                <div class="grid-profile">
                    <div class="card">
                        <div class="cal-header">
                            <button class="btn-icon-only btn-sm" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                            <span id="calMonthYear"></span>
                            <button class="btn-icon-only btn-sm" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="cal-grid" id="calGrid"></div>
                        <div style="margin-top:1rem; font-size:0.8rem; color:var(--text-muted); text-align:center;">Select date to view activity</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <span>Activity Log</span>
                            <span id="selectedDateDisplay" style="font-size:0.9rem; color:var(--primary)">Today</span>
                        </div>
                        <div id="activityLogContainer" style="height:300px; overflow-y:auto;">
                            <div style="text-align:center; padding:2rem; color:var(--text-muted);">Click a date on the calendar to view details.</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Account Settings</div>
                    <div style="display:flex; gap:1rem; flex-wrap:wrap;">
                        <button class="btn btn-secondary" onclick="exportData()"><i class="fas fa-download"></i> Export Data</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()"><i class="fas fa-upload"></i> Import Data</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('welcome-overlay').classList.add('active')"><i class="fas fa-question-circle"></i> Help Guide</button>
                        <button class="btn btn-secondary" onclick="if(confirm('Clear all local data?')) { localStorage.clear(); location.reload(); }"><i class="fas fa-trash"></i> Reset App</button>
                        <button class="btn btn-secondary" onclick="window.location.href='mailto:support@achievemate.com'"><i class="fas fa-bug"></i> Report Bug</button>
                        <button class="btn btn-danger" id="logoutBtn" style="display:none;" onclick="window.logoutUser()">Logout</button>
                    </div>
                    <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(this)">
                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->
    <div id="manageGoalsModal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;"><h3>Manage Tasks</h3><button class="btn-icon-only" onclick="closeModal('manageGoalsModal')">âœ•</button></div>
            <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
                <input type="text" id="newGoalInput" placeholder="Add new task...">
                <button class="btn btn-primary" onclick="addGoal()">Add</button>
            </div>
            <div id="manageGoalsList"></div>
        </div>
    </div>

    <div id="addPlaylistModal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;"><h3>New Course</h3><button class="btn-icon-only" onclick="closeModal('addPlaylistModal')">âœ•</button></div>
            <form onsubmit="savePlaylist(event)" id="addCourseForm">
                <input type="text" id="plName" required placeholder="Course Name" style="margin-bottom: 1rem;">
                <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                    <select id="plSource" style="width:50%; padding:0.75rem; background:var(--bg-body); color:var(--text-main); border:1px solid var(--border); border-radius:var(--radius-md);">
                        <option value="Youtube">YouTube</option>
                        <option value="Udemy">Udemy</option>
                        <option value="Coursera">Coursera</option>
                    </select>
                    <input type="url" id="plLink" placeholder="Course Link (Optional)" style="width:50%;">
                </div>
                <textarea id="plVideos" rows="5" required placeholder="Topics list (one per line)" style="margin-bottom:1rem;"></textarea>
                <button type="submit" class="btn btn-primary" style="width:100%">Create Course</button>
            </form>
        </div>
    </div>

    <!-- Edit Playlist Modal -->
    <div id="editPlaylistModal" class="modal-overlay">
        <div class="modal-box modal-lg">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;"><h3>Edit Course</h3><button class="btn-icon-only" onclick="closeModal('editPlaylistModal')">âœ•</button></div>
            <input type="hidden" id="editPlId">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 1rem;">
                <input type="text" id="editPlName" placeholder="Course Name">
                <input type="url" id="editPlLink" placeholder="Course URL">
            </div>
            <textarea id="editPlVideos" rows="10" placeholder="Topics (one per line)" style="margin-bottom:1rem; font-family:monospace; font-size:0.9rem;"></textarea>
            <div style="display:flex; justify-content:space-between;">
                <button class="btn btn-danger" onclick="deletePlaylist()">Delete Course</button>
                <button class="btn btn-primary" onclick="updatePlaylist()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Focus Overlay -->
    <div id="focus-overlay" class="modal-overlay" style="background:var(--bg-body); z-index:2000;">
        <div style="text-align:center;">
            <div id="overlayTask" style="font-size:1.5rem; color:var(--text-muted); margin-bottom:1rem;">Focusing</div>
            <div id="overlayTimer" style="font-size:6rem; font-weight:700; color:var(--primary); font-family:monospace; line-height:1;">25:00</div>
            <button class="btn btn-danger" style="margin-top:3rem; padding:1rem 2rem;" onclick="stopFullScreenFocus()">Stop Session</button>
        </div>
    </div>

    <!-- Firebase Logic (Module) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, sendEmailVerification, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        /* IMPORTANT: To use YOUR specific firebase project in your local file, 
           uncomment your config below and comment out the 'const firebaseConfig' line 
           that uses 'typeof __firebase_config'.
        */

        // Your specific config (Uncomment this block when you download!)
        /*
        const firebaseConfig = {
            apiKey: "AIzaSyBBuXEgTrEbAkj-BN_VSSYoVDx5e51fw4A",
            authDomain: "achieve-mate.firebaseapp.com",
            projectId: "achieve-mate",
            storageBucket: "achieve-mate.firebasestorage.app",
            messagingSenderId: "209711943902",
            appId: "1:209711943902:web:e8df445f14cc5c9b6eb24f"
        };
        */

        // System config for preview (Do not delete this line for the preview to work)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // --- GOOGLE LOGIN HANDLER ---
        window.handleGoogleAuth = async () => {
             const msg = document.getElementById('auth-msg');
             msg.textContent = "Opening Google Login...";
             msg.style.color = "var(--text-muted)";
             
             try {
                 await signInWithPopup(auth, googleProvider);
                 document.getElementById('auth-overlay').classList.remove('active');
                 msg.textContent = "";
             } catch (err) {
                 msg.style.color = 'var(--danger)';
                 console.error(err);
                 if (err.code === 'auth/popup-blocked') {
                     msg.textContent = "Popup blocked. Please allow popups for this site.";
                 } else if (err.code === 'auth/operation-not-allowed') {
                     msg.textContent = "Google Login is disabled in Firebase Console.";
                 } else if (err.message.includes('Cross-Origin-Opener-Policy')) {
                     msg.textContent = "Preview Mode Error: Open this page in a new tab/window to sign in with Google.";
                 } else {
                     msg.textContent = err.message;
                 }
             }
        }

        // --- EMAIL/PASSWORD HANDLER ---
        window.handleAuth = async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-password').value;
            const isSignup = document.getElementById('tab-signup').classList.contains('active');
            const msg = document.getElementById('auth-msg');
            
            msg.textContent = "Processing...";
            msg.style.color = "var(--text-muted)";

            try {
                if (isSignup) {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                    const user = userCredential.user;
                    await sendEmailVerification(user);
                    await signOut(auth);
                    msg.style.color = 'var(--success)';
                    msg.textContent = "Account created! Verification email sent. Please check your inbox.";
                } else {
                    const userCredential = await signInWithEmailAndPassword(auth, email, pass);
                    const user = userCredential.user;
                    if (!user.emailVerified) {
                        // document.getElementById('auth-overlay').classList.remove('active'); // Optionally force strict verification
                        msg.style.color = 'var(--accent)';
                        msg.textContent = "Warning: Email not verified yet.";
                         setTimeout(() => {
                             document.getElementById('auth-overlay').classList.remove('active');
                         }, 1500);
                    } else {
                        msg.textContent = "";
                        document.getElementById('auth-overlay').classList.remove('active');
                    }
                }
            } catch (err) {
                msg.style.color = 'var(--danger)';
                console.error("Auth Error:", err.code);
                if(err.code === 'auth/email-already-in-use') msg.textContent = "Email already registered. Try logging in.";
                else if(err.code === 'auth/wrong-password') msg.textContent = "Incorrect password.";
                else if(err.code === 'auth/user-not-found') msg.textContent = "No account found.";
                else if(err.code === 'auth/operation-not-allowed') msg.textContent = "Error: You MUST enable the top 'Email/Password' switch in Firebase Console.";
                else msg.textContent = err.message;
            }
        };

        document.getElementById('auth-form').addEventListener('submit', window.handleAuth);

        window.handleResetPassword = async () => {
            const email = document.getElementById('auth-email').value;
            const msg = document.getElementById('auth-msg');
            
            if (!email) {
                msg.style.color = 'var(--accent)';
                msg.textContent = "Please enter your email address in the input box above first.";
                return;
            }

            try {
                await sendPasswordResetEmail(auth, email);
                msg.style.color = 'var(--success)';
                msg.textContent = "Password reset link sent! Check your inbox.";
            } catch (err) {
                msg.style.color = 'var(--danger)';
                msg.textContent = err.message;
            }
        };

        window.logoutUser = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, (user) => {
            if (user) {
                if(!user.emailVerified) {
                     document.getElementById('verificationStatus').style.display = 'block';
                } else {
                     document.getElementById('verificationStatus').style.display = 'none';
                }

                document.getElementById('headerLoginBtn').style.display = 'none';
                document.getElementById('profileName').textContent = user.displayName || user.email.split('@')[0];
                document.getElementById('profileEmail').textContent = user.email;
                document.getElementById('profilePic').textContent = (user.displayName || user.email)[0].toUpperCase();
                document.getElementById('logoutBtn').style.display = 'inline-flex';
                loadCloudData(user.uid);
            } else {
                document.getElementById('headerLoginBtn').style.display = 'flex';
                document.getElementById('logoutBtn').style.display = 'none';
            }
        });

        async function loadCloudData(uid) {
            const snap = await getDoc(doc(db, "users", uid));
            if(snap.exists()) {
                window.appData = snap.data(); 
                window.refreshUI(); 
            }
        }
        
        window.saveCloudData = async () => {
            if(auth.currentUser) await setDoc(doc(db, "users", auth.currentUser.uid), window.appData);
        }
    </script>

    <!-- Main App Logic -->
    <script>
        window.appData = { playlists: [], dailyGoals: [], streak: 0, lastActive: null, history: {}, focusLogs: [], totalFocusTime: 0, isNewUser: true };
        let currentBadgeFilter = 'all';
        let currentCourseFilter = 'all';
        let calDate = new Date();
        let focusInterval = null;
        let currentTab = 'dashboard';

        // Password Visibility Toggle
        window.togglePasswordVisibility = function() {
            const input = document.getElementById('auth-password');
            const icon = document.getElementById('togglePassword');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function init() {
            const local = localStorage.getItem('achieveMate_v12');
            if(local) window.appData = JSON.parse(local);
            
            if(window.appData.isNewUser) {
                document.getElementById('welcome-overlay').classList.add('active');
            }

            updateGreeting();
            refreshUI();
            updateActiveTabUI('dashboard');
        }
        
        window.closeWelcomeGuide = function() {
            document.getElementById('welcome-overlay').classList.remove('active');
            window.appData.isNewUser = false;
            window.saveData();
        }

        window.refreshUI = function() {
            renderGoals();
            renderConsistencyGraph();
            renderPlaylists();
            renderAchievements();
            renderCalendar();
            renderFocusHistory();
            document.getElementById('headerStreak').textContent = window.appData.streak;
        }

        window.saveData = function() {
            localStorage.setItem('achieveMate_v12', JSON.stringify(window.appData));
            if(window.saveCloudData) window.saveCloudData();
        }

        // --- Navigation ---
        window.switchTab = function(id) {
            currentTab = id;
            document.querySelectorAll('.view-section').forEach(e => e.style.display = 'none');
            document.getElementById(id + '-view').style.display = 'block';
            updateActiveTabUI(id);
        }

        function updateActiveTabUI(id) {
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(e => e.classList.remove('active'));
            const pcNav = document.getElementById('nav-' + id);
            const mobNav = document.getElementById('mob-' + id);
            if(pcNav) pcNav.classList.add('active');
            if(mobNav) mobNav.classList.add('active');
        }

        window.toggleAuthMode = function(mode) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + mode).classList.add('active');
            document.getElementById('auth-btn').textContent = mode === 'login' ? 'Login' : 'Sign Up';
            
            const fp = document.getElementById('forgot-pass-container');
            if(mode === 'signup') fp.style.display = 'none';
            else fp.style.display = 'block';
        }

        // --- Goals Logic ---
        window.addGoal = function() {
            const txt = document.getElementById('newGoalInput').value.trim();
            if(!txt) return;
            window.appData.dailyGoals.push({ id: Date.now(), text: txt, done: false, date: new Date().toDateString() });
            document.getElementById('newGoalInput').value = '';
            window.saveData();
            window.refreshUI();
            renderManageGoalsList();
        }

        window.toggleGoal = function(id) {
            const g = window.appData.dailyGoals.find(x => x.id === id);
            if(g) {
                g.done = !g.done;
                logActivity('Goal', g.text);
                if(g.done) { triggerConfetti(); updateStreak(); }
                window.saveData();
                window.refreshUI(); 
            }
        }

        window.deleteGoal = function(id) {
            window.appData.dailyGoals = window.appData.dailyGoals.filter(x => x.id !== id);
            window.saveData();
            window.refreshUI();
            renderManageGoalsList();
        }

        function renderGoals() {
            const today = new Date().toDateString();
            const list = document.getElementById('dashboardGoalsList');
            const goals = window.appData.dailyGoals.filter(g => g.date === today);
            
            list.innerHTML = goals.length ? '' : document.getElementById('emptyGoalsMsg').outerHTML;
            document.getElementById('emptyGoalsMsg').style.display = goals.length ? 'none' : 'block';

            goals.forEach(g => {
                const div = document.createElement('div');
                div.className = `priority-item ${g.done?'checked':''}`;
                div.onclick = () => window.toggleGoal(g.id);
                div.innerHTML = `
                    <div class="priority-checkbox">${g.done?'<i class="fas fa-check"></i>':''}</div>
                    <div class="priority-text">${g.text}</div>
                `;
                list.appendChild(div);
            });
            
            const done = goals.filter(g=>g.done).length;
            document.getElementById('goalPct').textContent = goals.length ? Math.round((done/goals.length)*100)+'%' : '0%';
        }

        function renderManageGoalsList() {
            const today = new Date().toDateString();
            const list = document.getElementById('manageGoalsList');
            const goals = window.appData.dailyGoals.filter(g => g.date === today);
            list.innerHTML = goals.map(g => `
                <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid var(--border);">
                    <span>${g.text}</span>
                    <button class="btn-icon-only" style="color:var(--danger)" onclick="deleteGoal(${g.id})"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');
        }

        function renderConsistencyGraph() {
            const container = document.getElementById('consistencyGraph');
            container.innerHTML = '';
            const days = ['S','M','T','W','T','F','S'];
            for(let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const goals = window.appData.dailyGoals.filter(g => g.date === d.toDateString());
                const pct = goals.length ? (goals.filter(g=>g.done).length / goals.length)*100 : 0;
                container.innerHTML += `
                    <div class="graph-col">
                        <div style="height:100%; width:10px; background:rgba(255,255,255,0.05); border-radius:10px; display:flex; align-items:flex-end;">
                            <div class="graph-bar" style="height:${pct}%"></div>
                        </div>
                        <div class="graph-label">${days[d.getDay()]}</div>
                    </div>`;
            }
        }

        // --- Courses Logic ---
        window.savePlaylist = function(e) {
            e.preventDefault();
            const videos = document.getElementById('plVideos').value.split('\n').filter(v=>v.trim()).map(v=>({id:Date.now()+Math.random(), title:v, done:false}));
            const link = document.getElementById('plLink').value;
            window.appData.playlists.push({ id:Date.now(), name:document.getElementById('plName').value, source:document.getElementById('plSource').value, link:link, videos });
            window.closeModal('addPlaylistModal'); 
            window.saveData();
            window.refreshUI();
        }

        window.openModal = function(id) { 
            document.getElementById(id).classList.add('active'); 
            if(id==='manageGoalsModal') renderManageGoalsList(); 
            if(id==='addPlaylistModal') document.getElementById('addCourseForm').reset();
        }
        window.closeModal = function(id) { document.getElementById(id).classList.remove('active'); }

        window.toggleVideo = function(plId, vId) {
            const pl = window.appData.playlists.find(p=>p.id===plId);
            const v = pl.videos.find(x=>x.id===vId);
            v.done = !v.done;
            logActivity('Study', `${pl.name}: ${v.title}`);
            if(v.done) { triggerConfetti(); updateStreak(); }
            window.saveData();

            const btn = event.currentTarget; 
            if(v.done) btn.classList.add('checked'); else btn.classList.remove('checked');
            const checkIcon = btn.querySelector('.priority-checkbox');
            checkIcon.innerHTML = v.done ? '<i class="fas fa-check"></i>' : '';

            window.refreshUI();
        }

        window.openEditPlaylist = function(id) {
            const pl = window.appData.playlists.find(p=>p.id===id);
            document.getElementById('editPlId').value = id;
            document.getElementById('editPlName').value = pl.name;
            document.getElementById('editPlLink').value = pl.link || '';
            document.getElementById('editPlVideos').value = pl.videos.map(v=>v.title).join('\n');
            document.getElementById('editPlaylistModal').classList.add('active');
        }

        window.updatePlaylist = function() {
            const id = parseInt(document.getElementById('editPlId').value);
            const pl = window.appData.playlists.find(p=>p.id===id);
            pl.name = document.getElementById('editPlName').value;
            pl.link = document.getElementById('editPlLink').value;
            const lines = document.getElementById('editPlVideos').value.split('\n').filter(v=>v.trim());
            pl.videos = lines.map(title => {
                const existing = pl.videos.find(v => v.title === title);
                return existing ? existing : { id: Date.now()+Math.random(), title, done:false };
            });
            window.closeModal('editPlaylistModal'); window.saveData(); window.refreshUI();
        }

        window.deletePlaylist = function() {
            const id = parseInt(document.getElementById('editPlId').value);
            if(confirm("Delete this course?")) {
                window.appData.playlists = window.appData.playlists.filter(p=>p.id!==id);
                window.closeModal('editPlaylistModal'); window.saveData(); window.refreshUI();
            }
        }

        window.filterCourses = function(filter, btn) {
            currentCourseFilter = filter;
            document.querySelectorAll('.course-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderPlaylists();
        }

        function renderPlaylists() {
            const div = document.getElementById('playlistsContainer');
            div.innerHTML = '';
            let totalV=0, doneV=0;

            let filteredList = window.appData.playlists;
            if(currentCourseFilter === 'active') filteredList = filteredList.filter(p => { const d=p.videos.filter(v=>v.done).length; return d>0 && d<p.videos.length; });
            if(currentCourseFilter === 'completed') filteredList = filteredList.filter(p => { const d=p.videos.filter(v=>v.done).length; return d===p.videos.length && p.videos.length>0; });
            
            window.appData.playlists.forEach(pl => { totalV += pl.videos.length; doneV += pl.videos.filter(v=>v.done).length; });
            document.getElementById('topicPct').textContent = totalV ? Math.round((doneV/totalV)*100)+'%' : '0%';

            if (filteredList.length === 0) { div.innerHTML = `<div style="text-align:center; color:var(--text-muted); grid-column: 1/-1; padding: 2rem;">No courses found.</div>`; return; }
            
            filteredList.forEach(pl => {
                const done = pl.videos.filter(v=>v.done).length;
                const total = pl.videos.length;
                const pct = total ? Math.round((done/total)*100) : 0;
                
                const linkBtn = pl.link ? `
                    <a href="${pl.link}" target="_blank" class="course-edit-btn btn-link-external" onclick="event.stopPropagation()">
                        <i class="fas fa-external-link-alt"></i>
                    </a>` : '';

                div.innerHTML += `
                    <div class="course-card">
                        <div class="course-header" onclick="this.parentElement.querySelector('.video-accordion').classList.toggle('open')">
                            <div class="course-header-top">
                                <div class="course-title"><i class="fas fa-chevron-down"></i>${pl.name}</div>
                                <div class="course-badge">${pl.source}</div>
                            </div>
                            <div class="course-meta">
                                <span>${done} / ${total} Completed</span>
                            </div>
                            <div class="course-actions-container">
                                ${linkBtn}
                                <div class="course-edit-btn" onclick="event.stopPropagation(); openEditPlaylist(${pl.id})"><i class="fas fa-edit"></i></div>
                            </div>
                        </div>
                        <div class="course-progress-area">
                            <div style="height:6px; background:var(--bg-body); border-radius:3px; overflow:hidden;">
                                <div style="height:100%; background:var(--success); width:${pct}%"></div>
                            </div>
                            <div class="progress-text"><span>Progress</span><span>${pct}%</span></div>
                        </div>
                        <div class="video-accordion">
                            ${pl.videos.map(v => `
                                <div class="priority-item ${v.done?'checked':''}" style="border-radius:0; border:none; border-bottom:1px solid var(--border);" onclick="toggleVideo(${pl.id}, ${v.id})">
                                    <div class="priority-checkbox" style="width:18px; height:18px; font-size:10px;">${v.done?'<i class="fas fa-check"></i>':''}</div>
                                    <div class="priority-text" style="font-size:0.9rem;">${v.title}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
            });
        }

        // --- Awards ---
        window.filterBadges = function(cat, btn) {
            currentBadgeFilter = cat;
            document.querySelectorAll('.ach-filter-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            renderAchievements();
        }

        const BADGES = [
            { id: 's3', cat: 'streak', n: 'Streak 3', d: '3 Day Streak', t: 3, c: d=>d.streak },
            { id: 's7', cat: 'streak', n: 'Streak 7', d: '7 Day Streak', t: 7, c: d=>d.streak },
            { id: 's30', cat: 'streak', n: 'Streak 30', d: '30 Day Streak', t: 30, c: d=>d.streak },
            { id: 's50', cat: 'streak', n: 'Streak 50', d: '50 Day Streak', t: 50, c: d=>d.streak },
            { id: 's100', cat: 'streak', n: 'Streak 100', d: '100 Day Streak', t: 100, c: d=>d.streak },
            { id: 's150', cat: 'streak', n: 'Streak 150', d: '150 Day Streak', t: 150, c: d=>d.streak },
            { id: 's200', cat: 'streak', n: 'Streak 200', d: '200 Day Streak', t: 200, c: d=>d.streak },
            { id: 's365', cat: 'streak', n: 'Legend', d: '365 Day Streak', t: 365, c: d=>d.streak },
            { id: 'c1', cat: 'playlist', n: 'Creator', d: 'Create 1 Course', t: 1, c: d=>d.playlists.length },
            { id: 'f1', cat: 'playlist', n: 'Finisher', d: 'Finish 1 Course', t: 1, c: d=>d.playlists.filter(p=>p.videos.length>0 && p.videos.every(v=>v.done)).length },
            { id: 'f5', cat: 'playlist', n: 'Scholar', d: 'Finish 5 Courses', t: 5, c: d=>d.playlists.filter(p=>p.videos.length>0 && p.videos.every(v=>v.done)).length },
            { id: 'f10', cat: 'playlist', n: 'Master', d: 'Finish 10 Courses', t: 10, c: d=>d.playlists.filter(p=>p.videos.length>0 && p.videos.every(v=>v.done)).length },
            { id: 'f25', cat: 'playlist', n: 'Grandmaster', d: 'Finish 25 Courses', t: 25, c: d=>d.playlists.filter(p=>p.videos.length>0 && p.videos.every(v=>v.done)).length },
            { id: 't5', cat: 'focus', n: 'Focus 5', d: '5 Hours Focused', t: 300, c: d=>(d.totalFocusTime||0) },
            { id: 't10', cat: 'focus', n: 'Focus 10', d: '10 Hours Focused', t: 600, c: d=>(d.totalFocusTime||0) },
            { id: 't25', cat: 'focus', n: 'Focus 25', d: '25 Hours Focused', t: 1500, c: d=>(d.totalFocusTime||0) },
            { id: 't50', cat: 'focus', n: 'Focus 50', d: '50 Hours Focused', t: 3000, c: d=>(d.totalFocusTime||0) }
        ];

        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            grid.innerHTML = '';
            let mapped = BADGES.map(b => {
                const val = b.c(window.appData);
                const earned = val >= b.t;
                const pct = Math.min(100, Math.round((val/b.t)*100));
                return { ...b, earned, val, pct };
            });
            mapped.sort((a,b) => b.earned - a.earned);
            if(currentBadgeFilter !== 'all') mapped = mapped.filter(b => b.cat === currentBadgeFilter);

            mapped.forEach(b => {
                grid.innerHTML += `
                    <div class="ach-card ${b.earned?'earned':''}">
                        <div class="ach-icon"><i class="fas ${b.cat==='streak'?'fa-fire':b.cat==='focus'?'fa-clock':'fa-graduation-cap'}"></i></div>
                        <div class="ach-info" style="flex:1">
                            <h4>${b.n}</h4>
                            <p>${b.d}</p>
                            ${!b.earned ? `<div class="ach-progress"><div class="ach-fill" style="width:${b.pct}%"></div></div>` : '<div style="font-size:0.7rem; color:var(--success); margin-top:4px;"><i class="fas fa-check"></i> Unlocked</div>'}
                        </div>
                    </div>`;
            });

            const earnedCount = mapped.filter(b=>b.earned).length;
            document.getElementById('badgeCount').textContent = `${earnedCount} / 17`;
            const lastEarned = mapped.find(b=>b.earned);
            if(lastEarned) {
                document.getElementById('recentBadgeContent').innerHTML = `
                    <div style="display:flex; gap:15px; align-items:center;">
                        <div style="font-size:2rem; color:var(--accent);"><i class="fas fa-trophy"></i></div>
                        <div><div style="font-weight:600">${lastEarned.n}</div><div style="font-size:0.8rem; color:var(--text-muted)">Unlocked</div></div>
                    </div>`;
            } else {
                document.getElementById('recentBadgeContent').innerHTML = `<div style="color:var(--text-muted);">Keep working to unlock badges!</div>`;
            }
        }

        // --- Calendar & Profile ---
        window.changeMonth = function(dir) {
            calDate.setMonth(calDate.getMonth() + dir);
            renderCalendar();
        }

        function renderCalendar() {
            const y = calDate.getFullYear(), m = calDate.getMonth();
            document.getElementById('calMonthYear').textContent = calDate.toLocaleString('default', { month:'long', year:'numeric' });
            const grid = document.getElementById('calGrid');
            grid.innerHTML = ['S','M','T','W','T','F','S'].map(d=>`<div style="text-align:center; font-size:0.7rem; color:var(--text-muted);">${d}</div>`).join('');
            
            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m+1, 0).getDate();
            
            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;
            
            for(let i=1; i<=daysInMonth; i++) {
                const dString = new Date(y, m, i).toLocaleDateString('en-CA'); 
                const hasData = window.appData.history[dString];
                const isToday = new Date().toDateString() === new Date(y,m,i).toDateString();
                
                grid.innerHTML += `
                    <div class="cal-day ${isToday?'today':''} ${hasData?'has-data':''}" onclick="showActivity('${dString}')">
                        ${i}
                        ${hasData ? '<div class="cal-dot"></div>' : ''}
                    </div>`;
            }
        }

        window.showActivity = function(dateStr) {
            document.getElementById('selectedDateDisplay').textContent = new Date(dateStr).toDateString();
            const div = document.getElementById('activityLogContainer');
            const logs = window.appData.history[dateStr] || [];
            
            if(!logs.length) {
                div.innerHTML = `<div style="text-align:center; padding:2rem; color:var(--text-muted);">No activity recorded for this date.</div>`;
                return;
            }

            const studies = logs.filter(l => l.type === 'Study');
            const goals = logs.filter(l => l.type === 'Goal');
            const focus = logs.filter(l => l.type === 'Focus');
            
            // Grouping Logic
            const studyGroups = {};
            studies.forEach(s => {
                let [course, ...topic] = s.title.split(':');
                topic = topic.join(':').trim();
                if (!course) return;
                if (!studyGroups[course.trim()]) studyGroups[course.trim()] = [];
                studyGroups[course.trim()].push(topic || "General Study");
            });

            let html = '';
            if(goals.length) html += `<div class="activity-group type-goal"><div class="group-header">Goals (${goals.length})</div><div class="group-items show">${goals.map(g=>`<div>${g.title}</div>`).join('')}</div></div>`;
            
            for (const [course, topics] of Object.entries(studyGroups)) {
                html += `<div class="activity-group type-study"><div class="group-header">${course} (${topics.length})</div><div class="group-items show">${topics.map(t=>`<div>${t}</div>`).join('')}</div></div>`;
            }
            
            if(focus.length) html += `<div class="activity-group"><div class="group-header">Focus (${focus.length})</div><div class="group-items show">${focus.map(f=>`<div>${f.title}</div>`).join('')}</div></div>`;
            div.innerHTML = html;
        }

        function logActivity(type, title) {
            const d = new Date().toLocaleDateString('en-CA');
            if(!window.appData.history[d]) window.appData.history[d] = [];
            window.appData.history[d].unshift({ type, title, time: new Date().toLocaleTimeString() });
            renderCalendar();
        }

        // --- Focus Mode ---
        window.startFullScreenFocus = function() {
            const task = document.getElementById('focusTaskInput').value || "Deep Work";
            const mins = parseInt(document.getElementById('customFocusTime').value) || 25;
            document.getElementById('overlayTask').textContent = task;
            document.getElementById('focus-overlay').classList.add('active');
            let secs = mins * 60;
            
            if(focusInterval) clearInterval(focusInterval);
            focusInterval = setInterval(() => {
                secs--;
                const m = Math.floor(secs / 60);
                const s = secs % 60;
                document.getElementById('overlayTimer').textContent = `${m}:${s<10?'0':''}${s}`;
                if(secs <= 0) {
                    window.stopFullScreenFocus();
                    alert("Session Complete!");
                    triggerConfetti();
                    window.appData.totalFocusTime = (window.appData.totalFocusTime||0) + mins;
                    window.appData.focusLogs.unshift({ date: new Date().toLocaleString(), task, duration: mins });
                    logActivity('Focus', `${mins}m: ${task}`);
                    window.saveData();
                    window.refreshUI();
                }
            }, 1000);
        }

        window.stopFullScreenFocus = function() {
            clearInterval(focusInterval);
            document.getElementById('focus-overlay').classList.remove('active');
        }

        function renderFocusHistory() {
            document.getElementById('focusHistoryList').innerHTML = window.appData.focusLogs.map(f => `
                <div style="padding:10px; border-bottom:1px solid var(--border);">
                    <div style="font-weight:600">${f.task}</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">${f.duration}m â€¢ ${f.date}</div>
                </div>
            `).join('');
        }

        // --- Utilities ---
        function updateStreak() {
            const today = new Date().toDateString();
            if(window.appData.lastActive !== today) {
                const yest = new Date(); yest.setDate(yest.getDate()-1);
                if(window.appData.lastActive === yest.toDateString()) window.appData.streak++;
                else window.appData.streak = 1;
                window.appData.lastActive = today;
            }
        }

        function updateGreeting() {
            const h = new Date().getHours();
            document.getElementById('greetingText').textContent = h<12?"Good Morning!":h<18?"Good Afternoon!":"Good Evening!";
            document.getElementById('dateDisplay').textContent = new Date().toDateString();
        }
        
        function triggerConfetti() {
            for(let i=0; i<30; i++) {
                const c=document.createElement('div'); c.className='confetti';
                c.style.left=Math.random()*100+'vw'; c.style.backgroundColor=['#f00','#0f0','#00f','#ff0'][Math.floor(Math.random()*4)];
                c.style.animation=`confetti ${1+Math.random()}s linear`;
                document.body.appendChild(c); setTimeout(()=>c.remove(), 2000);
            }
        }

        window.exportData = function() {
            const a=document.createElement('a'); a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(window.appData));
            a.download="achieve_backup.json"; document.body.appendChild(a); a.click(); a.remove();
        }
        
        window.importData = function(input) {
            const f=input.files[0]; if(!f)return;
            const r=new FileReader(); r.onload=e=>{ try{ window.appData=JSON.parse(e.target.result); window.saveData(); alert("Success"); }catch(e){alert("Error");} };
            r.readAsText(f);
        }

        init();

    </script>
</body>
</html>
